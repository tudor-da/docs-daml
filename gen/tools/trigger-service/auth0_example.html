<!-- Copyright (c) 2021 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved. -->
<!-- SPDX-License-Identifier: Apache-2.0 -->



<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->

<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Auth0 Example Configuration &mdash; Daml SDK __VERSION__ documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
  
  <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
  <script type="text/javascript" src="../../_static/jquery.js"></script>
  <script type="text/javascript" src="../../_static/underscore.js"></script>
  <script type="text/javascript" src="../../_static/doctools.js"></script>
  <script type="text/javascript" src="../../_static/language_data.js"></script>
  <script type="text/javascript" src="../../_static/clipboard.min.js"></script>
  <script type="text/javascript" src="../../_static/copybutton.js"></script>
  
  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
  <link rel="index" title="Index" href="../../genindex.html" />
  <link rel="search" title="Search" href="../../search.html" />
  <link rel="next" title="Auth Middleware" href="../auth-middleware/index.html" />
  <link rel="prev" title="Authorization" href="authorization.html" /> 

  
  <link rel="icon" type="image/svg+xml"  href="../../_static/images/daml-logo-mark-light.svg">
  <link rel="alternate icon" href="../../_static/images/daml-favicon-1.ico">

  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-MSWJMNX');</script>
  <!-- End Google Tag Manager -->

  
  <!-- Mopinion Pastea.se  start --><script type="text/javascript">(function(){var id="4s6vwov7ad6qyxhq8iwbyhocrsn2nm36k25";var js=document.createElement("script");js.setAttribute("type","text/javascript");js.setAttribute("src","//deploy.mopinion.com/js/pastease.js");js.async=true;document.getElementsByTagName("head")[0].appendChild(js);var t=setInterval(function(){try{new Pastease.load(id);clearInterval(t)}catch(e){}},50)})();</script><!-- Mopinion Pastea.se end -->
</head>

<body class="wy-body-for-nav">
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MSWJMNX"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->
   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-nav-side-shadow"></div>
      <div class="wy-side-scroll">

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
          
          
          
          
          
          <ul>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Daml Documentation</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/installation.html">Installing the SDK</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started/path-variables.html">Setting JAVA_HOME and PATH variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started/manual-download.html">Manually installing the SDK</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/index.html">Building Your App</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/app-architecture.html">App Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/first-feature.html">Your First Feature</a></li>
<li class="toctree-l1"><a class="reference external" href="https://docs.daml.com/cheat-sheet">Cheat Sheet</a></li>
</ul>
<p class="caption"><span class="caption-text">Writing Daml</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../daml/intro/0_Intro.html">An introduction to Daml</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../daml/intro/1_Token.html">1 Basic contracts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/intro/2_DamlScript.html">2 Testing templates using Daml Script</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/intro/3_Data.html">3 Data types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/intro/4_Transformations.html">4 Transforming data using choices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/intro/5_Restrictions.html">5 Adding constraints to a contract</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/intro/6_Parties.html">6 Parties and authority</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/intro/7_Composing.html">7 Composing choices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/intro/8_Exceptions.html">8 Exception Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/intro/9_Dependencies.html">9 Working with Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/intro/10_Functional101.html">10 Functional Programming 101</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/intro/11_StdLib.html">11 Intro to the Daml Standard Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/intro/12_Testing.html">12 Testing Daml Contracts</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../daml/reference/index.html">Language reference docs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../daml/reference/structure.html">Overview: template structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/reference/templates.html">Templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/reference/choices.html">Choices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/reference/updates.html">Updates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/reference/data-types.html">Data types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/reference/working-with.html">Built-in functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/reference/expressions.html">Expressions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/reference/functions.html">Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/reference/scenarios.html">Scenarios</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/reference/file-structure.html">File structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/reference/packages.html">Packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/reference/contract-keys.html">Contract keys</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/reference/exceptions.html">Exceptions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../daml/troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../daml/patterns.html">Good design patterns</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../daml/patterns/initaccept.html">Initiate and Accept</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/patterns/multiparty-agreement.html">Multiple party agreement</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/patterns/delegation.html">Delegation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/patterns/authorization.html">Authorization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/patterns/locking.html">Locking</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../daml/patterns/locking/locking-by-archiving.html">Locking by archiving</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../daml/patterns/locking/locking-by-state.html">Locking by state</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../daml/patterns/locking/locking-by-safekeeping.html">Locking by safekeeping</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/patterns/legends.html">Diagram legends</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Building applications</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../app-dev/app-arch.html">Application architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../app-dev/bindings-ts/index.html">JavaScript Client Libraries</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/bindings-ts/daml2js.html">JavaScript Code Generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/bindings-ts/daml-react.html">&#64;daml/react</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/bindings-ts/daml-ledger.html">&#64;daml/ledger</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/bindings-ts/daml-types.html">&#64;daml/types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/bindings-ts/testing.html">Testing Your Web App</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../json-api/index.html">HTTP JSON API Service</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../json-api/lf-value-specification.html">Daml-LF JSON Encoding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../json-api/search-query-language.html">Query language</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../json-api/production-setup.html">Production Setup</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../daml-script/index.html">Daml Script</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../daml-repl/index.html">Daml REPL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../upgrade/index.html">Upgrading and Extending Daml applications</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../upgrade/extend.html">Extending Daml applications</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../upgrade/upgrade.html">Upgrading Daml applications</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../upgrade/automation.html">Automating the Upgrade Process</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../app-dev/authorization.html">Authorization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../app-dev/ledger-api.html">The Ledger API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/services.html">The Ledger API services</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/grpc/index.html">gRPC</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../app-dev/grpc/error-codes.html">Error Codes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/grpc/daml-to-ledger-api.html">How Daml types are translated to protobuf</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/daml-lf-translation.html">How Daml types are translated to Daml-LF</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/bindings-java/index.html">Java bindings</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../app-dev/bindings-java/codegen.html">Generate Java code from Daml</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../app-dev/bindings-java/example.html">Ping Pong Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../app-dev/bindings-java/quickstart.html">Iou Quickstart Tutorial</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/bindings-scala/index.html">Scala bindings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/bindings-js.html">Node.js bindings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/bindings-x-lang/index.html">Creating your own bindings</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../triggers/index.html">Daml Triggers - Off-Ledger Automation in Daml</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Trigger Service</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="authorization.html">Authorization</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Auth0 Example Configuration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../auth-middleware/index.html">Auth Middleware</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../auth-middleware/oauth2.html">OAuth 2.0 Auth Middleware</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Deploying to Daml ledgers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../deploy/index.html">Overview of Daml ledgers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../deploy/generic_ledger.html">Deploying to a generic Daml ledger</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../deploy/ledger-topologies.html">Daml Ledger Topologies</a></li>
</ul>
<p class="caption"><span class="caption-text">Operating Daml</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ops/index.html">Daml Participant pruning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ops/connect/index.html">Operating Daml Connect</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../ops/connect/helm.html">Connect Helm Chart</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ops/connect/auth0.html">Setting Up Auth0</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Developer Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../assistant.html">Daml Assistant (<code class="docutils literal notranslate"><span class="pre">daml</span></code>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../daml/daml-studio.html">Daml Studio</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sandbox.html">Daml Sandbox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../navigator/index.html">Navigator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../codegen.html">Daml codegen</a></li>
<li class="toctree-l1"><a class="reference internal" href="../profiler.html">Daml Profiler</a></li>
</ul>
<p class="caption"><span class="caption-text">Background concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../concepts/glossary.html">Glossary of concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../concepts/ledger-model/index.html">Daml Ledger Model</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../concepts/ledger-model/ledger-structure.html">Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../concepts/ledger-model/ledger-integrity.html">Integrity</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../concepts/ledger-model/ledger-privacy.html">Privacy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../concepts/ledger-model/ledger-daml.html">Daml: Defining Contract Models Compactly</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../concepts/ledger-model/ledger-exceptions.html">Exceptions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../concepts/identity-and-package-management.html">Identity and Package Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../concepts/time.html">Time</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../concepts/local-ledger.html">Causality and Local Ledgers</a></li>
</ul>
<p class="caption"><span class="caption-text">Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://daml.com/examples">Examples</a></li>
</ul>
<p class="caption"><span class="caption-text">Early Access Features</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../extractor.html">Extractor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../export/index.html">Ledger Export</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../daml-integration-kit/index.html">Daml Integration Kit</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../ledger-api-test-tool/index.html">Ledger API Test Tool</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../visual.html">Visualizing Daml Contracts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../concepts/interoperability.html">Ledger Interoperability</a></li>
<li class="toctree-l1"><a class="reference internal" href="../non-repudiation.html">Non-repudiation</a></li>
</ul>
<p class="caption"><span class="caption-text">Daml Ecosystem</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../support/overview.html">Daml Ecosystem Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../support/status-definitions.html">Status Definitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../support/component-statuses.html">Feature and Component Statuses</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../support/releases.html">Releases and Versioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../support/compatibility.html">Portability, Compatibility, and Support Durations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../support/support.html">Getting Help</a></li>
</ul>

          
          
          
          <div class="pdf-download"><a href="../../_downloads/DigitalAssetSDK.pdf" download>Download as PDF</a></div>
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <div class="topbar fixed">
        
        <nav class="wy-nav-top" aria-label="top navigation">
          
          <i data-toggle="wy-nav-top" class="wy-nav-top-toggle"></i>
          
        </nav>
        <!-- Copyright (c) 2021 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved. -->
<!-- SPDX-License-Identifier: Apache-2.0 -->

<div class="navbar">
    <h1><img src="../../_static/images/DAML_Logo_Blue.svg"></h1>
    <div class="navbar-menu">
        <div class="da-menu-item da-menu-depth-1" role="menu">
            <a href="https://www.daml.com/" role="menuitem" class="da-menu-link">Developers</a>
        </div>
        <div class="da-menu-item da-menu-depth-1" role="menu">
            <a href="https://www.digitalasset.com/products" role="menuitem" class="da-menu-link">Products</a>
        </div>
        <div class="da-menu-item da-menu-depth-1" role="menu">
            <a href="https://www.digitalasset.com" role="menuitem" class="da-menu-link">Company</a>
        </div>
    </div>
</div>

        <div class="version ">
          <span class="hide-mobile">Version&nbsp;</span><span class="version_switcher_placeholder"></span>
          
        </div>


        <!-- Copyright (c) 2021 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved. -->
<!-- SPDX-License-Identifier: Apache-2.0 -->
<div class="search-inline">
    <div id="rtd-search-inline-form" class="wy-form">
        <input type="text" class="search-inline-input" placeholder="Search" name="q">
        <img src="../../_static/images/Search.svg" class="search-inline-img"/>
    </div>
    <div class="search-alert">
        Please enter at least 3 letters.
    </div>
    <div id="search-inline-results" class="search-inline-results">
        
    </div>
</div>
          <!-- Copyright (c) 2021 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved. -->
<!-- SPDX-License-Identifier: Apache-2.0 -->

<div class="content-menu collapsed">
    <span class="content-menu-title">In This Section</span>
    <span class="content-menu-expand"></span>
    <div class="content-menu-wrapper">
        
        <!-- Local TOC -->
        <div class="content-menu-toc"><ul>
<li><a class="reference internal" href="#">Auth0 Example Configuration</a><ul>
<li><a class="reference internal" href="#configure-auth0">Configure Auth0</a><ul>
<li><a class="reference internal" href="#create-an-api">Create an API</a></li>
<li><a class="reference internal" href="#create-an-application">Create an Application</a></li>
<li><a class="reference internal" href="#create-a-rule">Create a Rule</a></li>
<li><a class="reference internal" href="#create-a-user">Create a User</a></li>
</ul>
</li>
<li><a class="reference internal" href="#start-daml-connect">Start Daml Connect</a><ul>
<li><a class="reference internal" href="#sandbox">Sandbox</a></li>
<li><a class="reference internal" href="#oauth-2-0-middleware">OAuth 2.0 Middleware</a></li>
<li><a class="reference internal" href="#trigger-service">Trigger Service</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configure-web-server">Configure Web Server</a></li>
<li><a class="reference internal" href="#test-the-setup">Test the Setup</a></li>
</ul>
</li>
</ul>
</div>
        
    </div>
</div>
        

      </div>
      <div class="wy-nav-content">
        
        <div class="rst-content">
          
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div itemprop="articleBody">
                
  <div class="section" id="auth0-example-configuration">
<h1>Auth0 Example Configuration<a class="headerlink" href="#auth0-example-configuration" title="Permalink to this headline">¶</a></h1>
<p>This section describes a minimal example configuration of the trigger service with authorization enabled
using <a class="reference external" href="https://auth0.com">Auth0</a> as the OAuth 2.0 provider together with the OAuth 2.0 middleware included in Daml Connect.
It uses the sandbox as the Daml ledger.</p>
<div class="section" id="configure-auth0">
<h2>Configure Auth0<a class="headerlink" href="#configure-auth0" title="Permalink to this headline">¶</a></h2>
<p>Sign up for an account on Auth0 to follow this guide.</p>
<div class="section" id="create-an-api">
<h3>Create an API<a class="headerlink" href="#create-an-api" title="Permalink to this headline">¶</a></h3>
<p>First, <a class="reference external" href="https://auth0.com/docs/get-started/set-up-apis">create a new API</a> on the Auth0 API dashboard.
This will represent the Daml ledger API and controls properties of access tokens issued for the ledger API.</p>
<ul class="simple">
<li>Enter the name of the API, e.g. <code class="docutils literal notranslate"><span class="pre">ex-daml-api</span></code>.</li>
<li>Enter the API identifier: <code class="docutils literal notranslate"><span class="pre">https://daml.com/ledger-api</span></code>.</li>
<li>Select the signing algorithm <code class="docutils literal notranslate"><span class="pre">RS256</span></code>.</li>
<li>Press the “create” button.</li>
</ul>
<p>Enter the <a class="reference external" href="https://auth0.com/docs/get-started/dashboard/api-settings">settings</a> of the newly created API.</p>
<ul class="simple">
<li>Allow offline access in the access settings section to enable issuance of refresh tokens.</li>
</ul>
</div>
<div class="section" id="create-an-application">
<h3>Create an Application<a class="headerlink" href="#create-an-application" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://auth0.com/docs/applications/set-up-an-application/register-native-applications">Create a new native application</a>.
This will represent the OAuth 2.0 middleware.</p>
<ul class="simple">
<li>Enter the name of the application, e.g. <code class="docutils literal notranslate"><span class="pre">ex-daml-auth-middleware</span></code>.</li>
<li>Choose the application type “native”.</li>
<li>Press the “create” button.</li>
</ul>
<p>Enter the <a class="reference external" href="https://auth0.com/docs/get-started/dashboard/application-settings">settings</a> of the newly created application.</p>
<ul>
<li><p class="first">Configure the allowed callback URLs: <code class="docutils literal notranslate"><span class="pre">http://localhost:5000/auth/cb</span></code>.</p>
<p>This is the URL to the callback endpoint of the auth middleware, in this case through the reverse proxy.</p>
</li>
<li><p class="first">Take note of the “Client ID” and “Client Secret” displayed in the “Basic Information” section.</p>
</li>
<li><dl class="first docutils">
<dt>Take note of the following URLs in the “Endpoints” tab of the advanced settings:</dt>
<dd><ul class="first last simple">
<li>OAuth Authorization URL,</li>
<li>OAuth Token URL, and</li>
<li>JSON Web Key Set.</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="create-a-rule">
<h3>Create a Rule<a class="headerlink" href="#create-a-rule" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://auth0.com/docs/rules/create-rules">Create a new rule</a>.
This will define user privileges, the mapping from scopes to ledger claims, and construct the access token.</p>
<p>Note, for simplicity this rule will grant access to any claims to any user.
In a real setup the rule will need to validate whether the user is authorized to access the requested claims.
Rules can be used to implement <a class="reference external" href="https://auth0.com/docs/authorization/sample-use-cases-rules-with-authorization">custom authorization policies</a>.</p>
<p>This rule will define a one-to-one mapping between scopes and Daml ledger claims,
this is compatible with the default request templates that are built into the OAuth 2.0 middleware.</p>
<ul>
<li><p class="first">Enter the name of the rule, e.g. <code class="docutils literal notranslate"><span class="pre">ex-daml-token</span></code>.</p>
</li>
<li><p class="first">Enter the following script:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="p">(</span><span class="nx">user</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// NOTE change the ledger ID to match your deployment.</span>
  <span class="kd">const</span> <span class="nx">ledgerId</span> <span class="o">=</span> <span class="s1">&#39;daml-auth0-example-ledger&#39;</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">apiId</span> <span class="o">=</span> <span class="s1">&#39;https://daml.com/ledger-api&#39;</span><span class="p">;</span>

  <span class="kd">const</span> <span class="nx">query</span> <span class="o">=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">request</span><span class="p">.</span><span class="nx">query</span><span class="p">;</span>

  <span class="c1">// Only handle ledger-api audience.</span>
  <span class="kd">const</span> <span class="nx">audience</span> <span class="o">=</span> <span class="nx">query</span> <span class="o">&amp;&amp;</span> <span class="nx">query</span><span class="p">.</span><span class="nx">audience</span> <span class="o">||</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">audience</span> <span class="o">!==</span> <span class="nx">apiId</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">user</span><span class="p">,</span> <span class="nx">context</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Determine requested claims.</span>
  <span class="kd">var</span> <span class="nx">admin</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">readAs</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="kd">var</span> <span class="nx">actAs</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="kd">var</span> <span class="nx">applicationId</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">scope</span> <span class="o">=</span> <span class="p">(</span><span class="nx">query</span> <span class="o">&amp;&amp;</span> <span class="nx">query</span><span class="p">.</span><span class="nx">scope</span> <span class="o">||</span> <span class="s2">&quot;&quot;</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">);</span>
  <span class="nx">scope</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">s</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">s</span> <span class="o">===</span> <span class="s2">&quot;admin&quot;</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">admin</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s2">&quot;readAs:&quot;</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">readAs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mf">7</span><span class="p">));</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s2">&quot;actAs:&quot;</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">actAs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mf">6</span><span class="p">));</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s2">&quot;applicationId:&quot;</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">applicationId</span> <span class="o">=</span> <span class="nx">s</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mf">14</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>

  <span class="c1">// Construct access token.</span>
  <span class="nx">context</span><span class="p">.</span><span class="nx">accessToken</span><span class="p">[</span><span class="nx">apiId</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;ledgerId&quot;</span><span class="o">:</span> <span class="nx">ledgerId</span><span class="p">,</span>
    <span class="s2">&quot;actAs&quot;</span><span class="o">:</span> <span class="nx">actAs</span><span class="p">,</span>
    <span class="s2">&quot;readAs&quot;</span><span class="o">:</span> <span class="nx">readAs</span><span class="p">,</span>
    <span class="s2">&quot;admin&quot;</span><span class="o">:</span> <span class="nx">admin</span>
  <span class="p">};</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">applicationId</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">accessToken</span><span class="p">[</span><span class="nx">apiId</span><span class="p">].</span><span class="nx">applicationId</span> <span class="o">=</span> <span class="nx">applicationId</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">user</span><span class="p">,</span> <span class="nx">context</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>You can use the <a class="reference external" href="https://auth0.com/docs/extensions/real-time-webtask-logs">Real-time Webtask Logs extension</a> to view any <code class="docutils literal notranslate"><span class="pre">console.log</span></code> output generated by your rule during the processing of authorization requests.</p>
</li>
</ul>
</div>
<div class="section" id="create-a-user">
<h3>Create a User<a class="headerlink" href="#create-a-user" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://auth0.com/docs/users/create-users">Create a new user</a>.</p>
<ul class="simple">
<li>Enter an email address, e.g. <code class="docutils literal notranslate"><span class="pre">alice&#64;example.com</span></code>.</li>
<li>Enter a secure password.</li>
<li>Remember the credentials.</li>
<li>Choose the “Username-Password-Authentication” connection.</li>
<li>Press the “create” button.</li>
</ul>
<p>Enter the <a class="reference external" href="https://auth0.com/docs/users/view-user-details">details page</a> of the newly created user.</p>
<ul class="simple">
<li>Edit the email address.</li>
<li>Press “Set email as verified”.</li>
<li>Press “save”.</li>
</ul>
</div>
</div>
<div class="section" id="start-daml-connect">
<h2>Start Daml Connect<a class="headerlink" href="#start-daml-connect" title="Permalink to this headline">¶</a></h2>
<p>Next, configure the relevant Daml Connect components to use Auth0 as the IAM.</p>
<div class="section" id="sandbox">
<h3>Sandbox<a class="headerlink" href="#sandbox" title="Permalink to this headline">¶</a></h3>
<p>Start the sandbox using the following command.
Replace <code class="docutils literal notranslate"><span class="pre">JSON_Web_Key_Set</span></code> by the corresponding URL found in the application settings
and make sure that the ledger ID matches the one in the Auth0 rule.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>daml sandbox <span class="se">\</span>
  --address localhost <span class="se">\</span>
  --port <span class="m">6865</span> <span class="se">\</span>
  --ledgerid daml-auth0-example-ledger <span class="se">\</span>
  --wall-clock-time <span class="se">\</span>
  --auth-jwt-rs256-jwks <span class="s2">&quot;JSON_Web_Key_Set&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="oauth-2-0-middleware">
<h3>OAuth 2.0 Middleware<a class="headerlink" href="#oauth-2-0-middleware" title="Permalink to this headline">¶</a></h3>
<p>Start the auth middleware using the following command.
Replace the client identifier and URL placeholders by the corresponding values found in the application settings
and make sure that the callback URL matches the allowed callback URL in the application settings.
The <code class="docutils literal notranslate"><span class="pre">--callback</span></code> flag defines the middleware’s callback URL as exposed through the reverse proxy.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nv">DAML_CLIENT_ID</span><span class="o">=</span><span class="s2">&quot;Client_ID&quot;</span> <span class="se">\</span>
<span class="nv">DAML_CLIENT_SECRET</span><span class="o">=</span><span class="s2">&quot;Client_Secret&quot;</span> <span class="se">\</span>
daml oauth2-middleware <span class="se">\</span>
  --address localhost <span class="se">\</span>
  --http-port <span class="m">3000</span> <span class="se">\</span>
  --oauth-auth <span class="s2">&quot;OAuth_Authorization_URL&quot;</span> <span class="se">\</span>
  --oauth-token <span class="s2">&quot;OAuth_Token_URL&quot;</span> <span class="se">\</span>
  --auth-jwt-rs256-jwks <span class="s2">&quot;JSON_Web_Key_Set&quot;</span> <span class="se">\</span>
  --callback http://localhost:5000/auth/cb
</pre></div>
</div>
</div>
<div class="section" id="trigger-service">
<h3>Trigger Service<a class="headerlink" href="#trigger-service" title="Permalink to this headline">¶</a></h3>
<p>Start the trigger service using the following command.
The <code class="docutils literal notranslate"><span class="pre">--auth</span></code> flag defines the middleware’s URL prefix as exposed through the reverse proxy,
similarly the <code class="docutils literal notranslate"><span class="pre">--auth-callback</span></code> flag defines the trigger service’s callback URL as exposed through the reverse proxy.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>daml trigger-service <span class="se">\</span>
  --address localhost <span class="se">\</span>
  --http-port <span class="m">4000</span> <span class="se">\</span>
  --ledger-host localhost <span class="se">\</span>
  --ledger-port <span class="m">6865</span> <span class="se">\</span>
  --auth http://localhost:5000/auth <span class="se">\</span>
  --auth-callback http://localhost:5000/trigger/cb
</pre></div>
</div>
</div>
</div>
<div class="section" id="configure-web-server">
<h2>Configure Web Server<a class="headerlink" href="#configure-web-server" title="Permalink to this headline">¶</a></h2>
<p>This guide uses <a class="reference external" href="https://www.nginx.com">Nginx</a> as a reverse proxy and web server.</p>
<ul>
<li><p class="first">Configure nginx using the following snippet:</p>
<div class="highlight-nginx notranslate"><div class="highlight"><pre><span></span><span class="k">http</span> <span class="p">{</span>
  <span class="kn">server</span> <span class="p">{</span>
    <span class="kn">listen</span> <span class="mi">5000</span><span class="p">;</span>
    <span class="kn">server_name</span> <span class="s">localhost</span><span class="p">;</span>
    <span class="kn">root</span> <span class="s">html</span><span class="p">;</span>

    <span class="kn">location</span> <span class="s">/auth/</span> <span class="p">{</span>
      <span class="kn">proxy_pass</span> <span class="s">http://localhost:3000/</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kn">location</span> <span class="s">/trigger/</span> <span class="p">{</span>
      <span class="kn">proxy_pass</span> <span class="s">http://localhost:4000/</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This exposes the auth middleware under the URL <code class="docutils literal notranslate"><span class="pre">http://localhost:3000/</span></code>
and the trigger service under the URL <code class="docutils literal notranslate"><span class="pre">http://localhost:4000/</span></code>.</p>
</li>
<li><p class="first">Add the following <code class="docutils literal notranslate"><span class="pre">index.html</span></code> to your web root:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onclick</span><span class="o">=</span><span class="s">&quot;listTriggers()&quot;</span><span class="p">&gt;</span>list triggers<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="k">async</span> <span class="kd">function</span> <span class="nx">listTriggers</span><span class="p">()</span> <span class="p">{</span>
      <span class="c1">// The rule defined above accepts all claims for all users.</span>
      <span class="c1">// So, we can always access claims to the party Alice.</span>
      <span class="kd">const</span> <span class="nx">resp</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="s2">&quot;http://localhost:5000/trigger/v1/triggers?party=Alice&quot;</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">resp</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mf">401</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">challenge</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Unauthorized </span><span class="si">${</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">challenge</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">loginUrl</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">URL</span><span class="p">(</span><span class="nx">challenge</span><span class="p">.</span><span class="nx">login</span><span class="p">);</span>
        <span class="nx">loginUrl</span><span class="p">.</span><span class="nx">searchParams</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;redirect_uri&quot;</span><span class="p">,</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">);</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">loginUrl</span><span class="p">.</span><span class="nx">href</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">body</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">text</span><span class="p">();</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`(</span><span class="si">${</span><span class="nx">resp</span><span class="p">.</span><span class="nx">status</span><span class="si">}</span><span class="sb">) </span><span class="si">${</span><span class="nx">body</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>This defines a very simple web site with a single button
that will request the list of Alice’s running triggers from the trigger service.
If the user is authorized it will print the list to the JavaScript console,
otherwise it will redirect to auth middleware’s login endpoint to obtain authorization.</p>
</li>
</ul>
</div>
<div class="section" id="test-the-setup">
<h2>Test the Setup<a class="headerlink" href="#test-the-setup" title="Permalink to this headline">¶</a></h2>
<p>Use the following commands to determine if the OAuth 2.0 middleware and trigger service are running and available through the reverse proxy.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ curl http://localhost:5000/auth/livez
<span class="o">{</span><span class="s2">&quot;status&quot;</span>:<span class="s2">&quot;pass&quot;</span><span class="o">}</span>
$ curl http://localhost:5000/trigger/livez
<span class="o">{</span><span class="s2">&quot;status&quot;</span>:<span class="s2">&quot;pass&quot;</span><span class="o">}</span>
</pre></div>
</div>
<p>Direct your web browser to the URL <code class="docutils literal notranslate"><span class="pre">http://localhost:5000</span></code>.
It should display the test page with the single “list triggers” button defined above.</p>
<ul>
<li><p class="first">Open the JavaScript console.</p>
</li>
<li><p class="first">Press the “list triggers” button.</p>
</li>
<li><p class="first">An “Unauthorized” message should appear in the console and you should be redirected to the auth0 login page.</p>
</li>
<li><p class="first">Login with the credentials of the auth0 user that you created before.</p>
</li>
<li><p class="first">The browser should be redirected to the test page.</p>
</li>
<li><p class="first">Click the button again. This time a message like the following should appear in the console.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(200) {&quot;result&quot;:{&quot;triggerIds&quot;:[]},&quot;status&quot;:200}
</pre></div>
</div>
</li>
</ul>
</div>
</div>


              
            </div>
            
            
              <!-- Copyright (c) 2021 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved. -->
<!-- SPDX-License-Identifier: Apache-2.0 -->

<footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="authorization.html" class="da-btn da-btn-label btn-prev" title="Authorization" accesskey="p" rel="prev">Previous</a>
      
      
        <a href="../auth-middleware/index.html" class="da-btn da-btn-label btn-next" title="Auth Middleware" accesskey="n" rel="next">Next</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        Copyright (c) 2021 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved. Any unauthorized use, duplication or distribution is strictly prohibited. &#34;Digital Asset&#34; and &#34;Daml&#34; are Registered in the U.S. Patent and Trademark Office.

    </p>
  </div> 

</footer>
            
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- Copyright (c) 2021 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved. -->
<!-- SPDX-License-Identifier: Apache-2.0 -->





  <script type="text/javascript">
    jQuery(function () {
      SphinxRtdTheme.Navigation.enable(true);
      });
  </script>


  
    
  
  <div id="inpageContent"></div>
  

</body>
</html>