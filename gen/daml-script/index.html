<!-- Copyright (c) 2021 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved. -->
<!-- SPDX-License-Identifier: Apache-2.0 -->



<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->

<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Daml Script &mdash; Daml SDK __VERSION__ documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
  
  <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
  <script type="text/javascript" src="../_static/jquery.js"></script>
  <script type="text/javascript" src="../_static/underscore.js"></script>
  <script type="text/javascript" src="../_static/doctools.js"></script>
  <script type="text/javascript" src="../_static/language_data.js"></script>
  <script type="text/javascript" src="../_static/clipboard.min.js"></script>
  <script type="text/javascript" src="../_static/copybutton.js"></script>
  
  <script type="text/javascript" src="../_static/js/theme.js"></script>

  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
  <link rel="index" title="Index" href="../genindex.html" />
  <link rel="search" title="Search" href="../search.html" />
  <link rel="next" title="Daml REPL" href="../daml-repl/index.html" />
  <link rel="prev" title="Production Setup" href="../json-api/production-setup.html" /> 

  
  <link rel="icon" type="image/svg+xml"  href="../_static/images/daml-logo-mark-light.svg">
  <link rel="alternate icon" href="../_static/images/daml-favicon-1.ico">

  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-MSWJMNX');</script>
  <!-- End Google Tag Manager -->

  
  <!-- Mopinion Pastea.se  start --><script type="text/javascript">(function(){var id="4s6vwov7ad6qyxhq8iwbyhocrsn2nm36k25";var js=document.createElement("script");js.setAttribute("type","text/javascript");js.setAttribute("src","//deploy.mopinion.com/js/pastease.js");js.async=true;document.getElementsByTagName("head")[0].appendChild(js);var t=setInterval(function(){try{new Pastease.load(id);clearInterval(t)}catch(e){}},50)})();</script><!-- Mopinion Pastea.se end -->
</head>

<body class="wy-body-for-nav">
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MSWJMNX"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->
   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-nav-side-shadow"></div>
      <div class="wy-side-scroll">

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
          
          
          
          
          
          <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Daml Documentation</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting-started/installation.html">Installing the SDK</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../getting-started/path-variables.html">Setting JAVA_HOME and PATH variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting-started/manual-download.html">Manually installing the SDK</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started/index.html">Building Your App</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started/app-architecture.html">App Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started/first-feature.html">Your First Feature</a></li>
<li class="toctree-l1"><a class="reference external" href="https://docs.daml.com/cheat-sheet">Cheat Sheet</a></li>
</ul>
<p class="caption"><span class="caption-text">Writing Daml</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../daml/intro/0_Intro.html">An introduction to Daml</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../daml/intro/1_Token.html">1 Basic contracts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/intro/2_DamlScript.html">2 Testing templates using Daml Script</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/intro/3_Data.html">3 Data types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/intro/4_Transformations.html">4 Transforming data using choices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/intro/5_Restrictions.html">5 Adding constraints to a contract</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/intro/6_Parties.html">6 Parties and authority</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/intro/7_Composing.html">7 Composing choices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/intro/8_Exceptions.html">8 Exception Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/intro/9_Dependencies.html">9 Working with Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/intro/10_Functional101.html">10 Functional Programming 101</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/intro/11_StdLib.html">11 Intro to the Daml Standard Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/intro/12_Testing.html">12 Testing Daml Contracts</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../daml/reference/index.html">Language reference docs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../daml/reference/structure.html">Overview: template structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/reference/templates.html">Templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/reference/choices.html">Choices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/reference/updates.html">Updates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/reference/data-types.html">Data types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/reference/working-with.html">Built-in functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/reference/expressions.html">Expressions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/reference/functions.html">Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/reference/scenarios.html">Scenarios</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/reference/file-structure.html">File structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/reference/packages.html">Packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/reference/contract-keys.html">Contract keys</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/reference/exceptions.html">Exceptions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../daml/troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../daml/patterns.html">Good design patterns</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../daml/patterns/initaccept.html">Initiate and Accept</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/patterns/multiparty-agreement.html">Multiple party agreement</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/patterns/delegation.html">Delegation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/patterns/authorization.html">Authorization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/patterns/locking.html">Locking</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../daml/patterns/locking/locking-by-archiving.html">Locking by archiving</a></li>
<li class="toctree-l3"><a class="reference internal" href="../daml/patterns/locking/locking-by-state.html">Locking by state</a></li>
<li class="toctree-l3"><a class="reference internal" href="../daml/patterns/locking/locking-by-safekeeping.html">Locking by safekeeping</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../daml/patterns/legends.html">Diagram legends</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Building applications</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../app-dev/app-arch.html">Application architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../app-dev/bindings-ts/index.html">JavaScript Client Libraries</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../app-dev/bindings-ts/daml2js.html">JavaScript Code Generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../app-dev/bindings-ts/daml-react.html">&#64;daml/react</a></li>
<li class="toctree-l2"><a class="reference internal" href="../app-dev/bindings-ts/daml-ledger.html">&#64;daml/ledger</a></li>
<li class="toctree-l2"><a class="reference internal" href="../app-dev/bindings-ts/daml-types.html">&#64;daml/types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../app-dev/bindings-ts/testing.html">Testing Your Web App</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../json-api/index.html">HTTP JSON API Service</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../json-api/lf-value-specification.html">Daml-LF JSON Encoding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../json-api/search-query-language.html">Query language</a></li>
<li class="toctree-l2"><a class="reference internal" href="../json-api/production-setup.html">Production Setup</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Daml Script</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../daml-repl/index.html">Daml REPL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../upgrade/index.html">Upgrading and Extending Daml applications</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../upgrade/extend.html">Extending Daml applications</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../upgrade/upgrade.html">Upgrading Daml applications</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../upgrade/automation.html">Automating the Upgrade Process</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../app-dev/authorization.html">Authorization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../app-dev/ledger-api.html">The Ledger API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../app-dev/services.html">The Ledger API services</a></li>
<li class="toctree-l2"><a class="reference internal" href="../app-dev/grpc/index.html">gRPC</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../app-dev/grpc/error-codes.html">Error Codes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../app-dev/grpc/daml-to-ledger-api.html">How Daml types are translated to protobuf</a></li>
<li class="toctree-l2"><a class="reference internal" href="../app-dev/daml-lf-translation.html">How Daml types are translated to Daml-LF</a></li>
<li class="toctree-l2"><a class="reference internal" href="../app-dev/bindings-java/index.html">Java bindings</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../app-dev/bindings-java/codegen.html">Generate Java code from Daml</a></li>
<li class="toctree-l3"><a class="reference internal" href="../app-dev/bindings-java/example.html">Ping Pong Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="../app-dev/bindings-java/quickstart.html">Iou Quickstart Tutorial</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../app-dev/bindings-scala/index.html">Scala bindings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../app-dev/bindings-js.html">Node.js bindings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../app-dev/bindings-x-lang/index.html">Creating your own bindings</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../triggers/index.html">Daml Triggers - Off-Ledger Automation in Daml</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tools/trigger-service/index.html">Trigger Service</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tools/trigger-service/authorization.html">Authorization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tools/trigger-service/auth0_example.html">Auth0 Example Configuration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tools/auth-middleware/index.html">Auth Middleware</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tools/auth-middleware/oauth2.html">OAuth 2.0 Auth Middleware</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Deploying to Daml ledgers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../deploy/index.html">Overview of Daml ledgers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deploy/generic_ledger.html">Deploying to a generic Daml ledger</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deploy/ledger-topologies.html">Daml Ledger Topologies</a></li>
</ul>
<p class="caption"><span class="caption-text">Operating Daml</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../ops/index.html">Daml Participant pruning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ops/connect/index.html">Operating Daml Connect</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../ops/connect/helm.html">Connect Helm Chart</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ops/connect/auth0.html">Setting Up Auth0</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Developer Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tools/assistant.html">Daml Assistant (<code class="docutils literal notranslate"><span class="pre">daml</span></code>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../daml/daml-studio.html">Daml Studio</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/sandbox.html">Daml Sandbox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/navigator/index.html">Navigator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/codegen.html">Daml codegen</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/profiler.html">Daml Profiler</a></li>
</ul>
<p class="caption"><span class="caption-text">Background concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../concepts/glossary.html">Glossary of concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/ledger-model/index.html">Daml Ledger Model</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../concepts/ledger-model/ledger-structure.html">Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/ledger-model/ledger-integrity.html">Integrity</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/ledger-model/ledger-privacy.html">Privacy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/ledger-model/ledger-daml.html">Daml: Defining Contract Models Compactly</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/ledger-model/ledger-exceptions.html">Exceptions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/identity-and-package-management.html">Identity and Package Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/time.html">Time</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/local-ledger.html">Causality and Local Ledgers</a></li>
</ul>
<p class="caption"><span class="caption-text">Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://daml.com/examples">Examples</a></li>
</ul>
<p class="caption"><span class="caption-text">Early Access Features</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tools/extractor.html">Extractor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/export/index.html">Ledger Export</a></li>
<li class="toctree-l1"><a class="reference internal" href="../daml-integration-kit/index.html">Daml Integration Kit</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tools/ledger-api-test-tool/index.html">Ledger API Test Tool</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tools/visual.html">Visualizing Daml Contracts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/interoperability.html">Ledger Interoperability</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/non-repudiation.html">Non-repudiation</a></li>
</ul>
<p class="caption"><span class="caption-text">Daml Ecosystem</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../support/overview.html">Daml Ecosystem Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../support/status-definitions.html">Status Definitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../support/component-statuses.html">Feature and Component Statuses</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../support/releases.html">Releases and Versioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../support/compatibility.html">Portability, Compatibility, and Support Durations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../support/support.html">Getting Help</a></li>
</ul>

          
          
          
          <div class="pdf-download"><a href="../_downloads/DigitalAssetSDK.pdf" download>Download as PDF</a></div>
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <div class="topbar fixed">
        
        <nav class="wy-nav-top" aria-label="top navigation">
          
          <i data-toggle="wy-nav-top" class="wy-nav-top-toggle"></i>
          
        </nav>
        <!-- Copyright (c) 2021 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved. -->
<!-- SPDX-License-Identifier: Apache-2.0 -->

<div class="navbar">
    <h1><img src="../_static/images/DAML_Logo_Blue.svg"></h1>
    <div class="navbar-menu">
        <div class="da-menu-item da-menu-depth-1" role="menu">
            <a href="https://www.daml.com/" role="menuitem" class="da-menu-link">Developers</a>
        </div>
        <div class="da-menu-item da-menu-depth-1" role="menu">
            <a href="https://www.digitalasset.com/products" role="menuitem" class="da-menu-link">Products</a>
        </div>
        <div class="da-menu-item da-menu-depth-1" role="menu">
            <a href="https://www.digitalasset.com" role="menuitem" class="da-menu-link">Company</a>
        </div>
    </div>
</div>

        <div class="version ">
          <span class="hide-mobile">Version&nbsp;</span><span class="version_switcher_placeholder"></span>
          
        </div>


        <!-- Copyright (c) 2021 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved. -->
<!-- SPDX-License-Identifier: Apache-2.0 -->
<div class="search-inline">
    <div id="rtd-search-inline-form" class="wy-form">
        <input type="text" class="search-inline-input" placeholder="Search" name="q">
        <img src="../_static/images/Search.svg" class="search-inline-img"/>
    </div>
    <div class="search-alert">
        Please enter at least 3 letters.
    </div>
    <div id="search-inline-results" class="search-inline-results">
        
    </div>
</div>
          <!-- Copyright (c) 2021 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved. -->
<!-- SPDX-License-Identifier: Apache-2.0 -->

<div class="content-menu collapsed">
    <span class="content-menu-title">In This Section</span>
    <span class="content-menu-expand"></span>
    <div class="content-menu-wrapper">
        
        <!-- Local TOC -->
        <div class="content-menu-toc"><ul>
<li><a class="reference internal" href="#">Daml Script</a><ul>
<li><a class="reference internal" href="#usage">Usage</a><ul>
<li><a class="reference internal" href="#party-management">Party management</a></li>
<li><a class="reference internal" href="#queries">Queries</a></li>
<li><a class="reference internal" href="#running-a-script">Running a Script</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-daml-script-for-ledger-initialization">Using Daml Script for Ledger Initialization</a><ul>
<li><a class="reference internal" href="#migrating-from-scenarios">Migrating from Scenarios</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-daml-script-in-distributed-topologies">Using Daml Script in Distributed Topologies</a></li>
<li><a class="reference internal" href="#running-daml-script-against-ledgers-with-authorization">Running Daml Script against Ledgers with Authorization</a></li>
<li><a class="reference internal" href="#running-daml-script-against-the-http-json-api">Running Daml Script against the HTTP JSON API</a></li>
</ul>
</li>
</ul>
</div>
        
    </div>
</div>
        

      </div>
      <div class="wy-nav-content">
        
        <div class="rst-content">
          
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div itemprop="articleBody">
                
  <div class="section" id="daml-script">
<h1>Daml Script<a class="headerlink" href="#daml-script" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<p>Daml scenarios provide a simple way for testing Daml models
and getting quick feedback in Daml studio. However, scenarios are run
in a special process and do not interact with an actual ledger. This
means that you cannot use scenarios to test other ledger clients,
e.g., your UI or <a class="reference internal" href="../triggers/index.html"><span class="doc">Daml triggers</span></a>.</p>
<p>Daml Script addresses this problem by providing you with an API with
the simplicity of Daml scenarios and all the benefits such as being
able to reuse your Daml types and logic while running against an
actual ledger in addition to allowing you to experiment in
<a class="reference internal" href="../daml/daml-studio.html#scenario-script-results"><span class="std std-ref">Daml Studio</span></a>.  This means that you can use it for
application scripting, to test automation logic and also for
<a class="reference internal" href="#script-ledger-initialization"><span class="std std-ref">ledger initialization</span></a>.</p>
<p>You can also use Daml Script interactively using <a class="reference internal" href="../daml-repl/index.html"><span class="doc">Daml REPL</span></a>.</p>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">Remember that you can load all the example code by running <code class="docutils literal notranslate"><span class="pre">daml</span> <span class="pre">new</span> <span class="pre">script-example</span> <span class="pre">--template</span> <span class="pre">script-example</span></code></p>
</div>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>Our example for this tutorial consists of 2 templates.</p>
<p>First, we have a template called <code class="docutils literal notranslate"><span class="pre">Coin</span></code>:</p>
<div class="highlight-daml notranslate"><div class="highlight"><pre><span></span><span class="kr">template</span> <span class="kt">Coin</span>
  <span class="kr">with</span>
    <span class="n">issuer</span> <span class="kt">:</span> <span class="kt">Party</span>
    <span class="n">owner</span> <span class="kt">:</span> <span class="kt">Party</span>
  <span class="kr">where</span>
    <span class="kr">signatory</span> <span class="n">issuer</span><span class="p">,</span> <span class="n">owner</span>
</pre></div>
</div>
<p>This template represents a coin issued to <code class="docutils literal notranslate"><span class="pre">owner</span></code> by <code class="docutils literal notranslate"><span class="pre">issuer</span></code>.
<code class="docutils literal notranslate"><span class="pre">Coin</span></code> has both the <code class="docutils literal notranslate"><span class="pre">owner</span></code> and the <code class="docutils literal notranslate"><span class="pre">issuer</span></code> as signatories.</p>
<p>Second, we have a template called <code class="docutils literal notranslate"><span class="pre">CoinProposal</span></code>:</p>
<div class="highlight-daml notranslate"><div class="highlight"><pre><span></span><span class="kr">template</span> <span class="kt">CoinProposal</span>
  <span class="kr">with</span>
    <span class="n">coin</span> <span class="kt">:</span> <span class="kt">Coin</span>
  <span class="kr">where</span>
    <span class="kr">signatory</span> <span class="n">coin</span><span class="o">.</span><span class="n">issuer</span>
    <span class="kr">observer</span> <span class="n">coin</span><span class="o">.</span><span class="n">owner</span>

    <span class="n">choice</span> <span class="kt">Accept</span> <span class="kt">:</span> <span class="kt">ContractId</span> <span class="kt">Coin</span>
      <span class="kr">controller</span> <span class="n">coin</span><span class="o">.</span><span class="n">owner</span>
      <span class="kr">do</span> <span class="n">create</span> <span class="n">coin</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">CoinProposal</span></code> is only signed by the <code class="docutils literal notranslate"><span class="pre">issuer</span></code> and it provides a
single <code class="docutils literal notranslate"><span class="pre">Accept</span></code> choice which, when exercised by the controller will
create the corresponding <code class="docutils literal notranslate"><span class="pre">Coin</span></code>.</p>
<p>Having defined the templates, we can now move on to write Daml scripts
that operate on these templates. To get access to the API used to implement Daml scripts, you need to add the <code class="docutils literal notranslate"><span class="pre">daml-script</span></code>
library to the <code class="docutils literal notranslate"><span class="pre">dependencies</span></code> field in <code class="docutils literal notranslate"><span class="pre">daml.yaml</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dependencies</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">daml</span><span class="o">-</span><span class="n">prim</span>
  <span class="o">-</span> <span class="n">daml</span><span class="o">-</span><span class="n">stdlib</span>
  <span class="o">-</span> <span class="n">daml</span><span class="o">-</span><span class="n">script</span>
</pre></div>
</div>
<p>We also enable the <code class="docutils literal notranslate"><span class="pre">ApplicativeDo</span></code> extension. We will
see below why this is useful.</p>
<div class="highlight-daml notranslate"><div class="highlight"><pre><span></span><span class="cm">{-# LANGUAGE ApplicativeDo #-}</span>

<span class="kr">module</span> <span class="nn">ScriptExample</span> <span class="kr">where</span>

<span class="kr">import</span> <span class="nn">Daml.Script</span>
</pre></div>
</div>
<p>Since on an actual ledger parties cannot be arbitrary strings, we
define a record containing all the parties that we will use in our
script so that we can easily swap them out.</p>
<div class="highlight-daml notranslate"><div class="highlight"><pre><span></span><span class="kr">data</span> <span class="kt">LedgerParties</span> <span class="ow">=</span> <span class="kt">LedgerParties</span> <span class="kr">with</span>
  <span class="n">bank</span> <span class="kt">:</span> <span class="kt">Party</span>
  <span class="n">alice</span> <span class="kt">:</span> <span class="kt">Party</span>
  <span class="n">bob</span> <span class="kt">:</span> <span class="kt">Party</span>
</pre></div>
</div>
<p>Let us now write a function to initialize the ledger with 3
<code class="docutils literal notranslate"><span class="pre">CoinProposal</span></code> contracts and accept 2 of them. This function takes the
<code class="docutils literal notranslate"><span class="pre">LedgerParties</span></code> as an argument and return something of type <code class="docutils literal notranslate"><span class="pre">Script</span>
<span class="pre">()</span></code> which is Daml script’s equivalent of <code class="docutils literal notranslate"><span class="pre">Scenario</span> <span class="pre">()</span></code>.</p>
<div class="highlight-daml notranslate"><div class="highlight"><pre><span></span><span class="nf">initialize</span> <span class="kt">:</span> <span class="kt">LedgerParties</span> <span class="ow">-&gt;</span> <span class="kt">Script</span> <span class="nb">()</span>
<span class="nf">initialize</span> <span class="n">parties</span> <span class="ow">=</span> <span class="kr">do</span>
</pre></div>
</div>
<p>First we create the proposals. To do so, we use the <code class="docutils literal notranslate"><span class="pre">submit</span></code>
function to submit a transaction. The first argument is the party
submitting the transaction. In our case, we want all proposals to be
created by the bank so we use <code class="docutils literal notranslate"><span class="pre">parties.bank</span></code>. The second argument
must be of type <code class="docutils literal notranslate"><span class="pre">Commands</span> <span class="pre">a</span></code> so in our case <code class="docutils literal notranslate"><span class="pre">Commands</span> <span class="pre">(ContractId</span>
<span class="pre">CoinProposal,</span> <span class="pre">ContractId</span> <span class="pre">CoinProposal,</span> <span class="pre">ContractId</span> <span class="pre">CoinProposal)</span></code>
corresponding to the 3 proposals that we create. <code class="docutils literal notranslate"><span class="pre">Commands</span></code> is
similar to <code class="docutils literal notranslate"><span class="pre">Update</span></code> which is used in the <code class="docutils literal notranslate"><span class="pre">submit</span></code> function in
scenarios. However, <code class="docutils literal notranslate"><span class="pre">Commands</span></code> requires that the individual commands
do not depend on each other. This matches the restriction on the
Ledger API where a transaction consists of a list of commands.  Using
<code class="docutils literal notranslate"><span class="pre">ApplicativeDo</span></code> we can still use <code class="docutils literal notranslate"><span class="pre">do</span></code>-notation as long as we
respect this and the last statement in the <code class="docutils literal notranslate"><span class="pre">do</span></code>-block is of the form
<code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">expr</span></code> or <code class="docutils literal notranslate"><span class="pre">pure</span> <span class="pre">expr</span></code>.
In <code class="docutils literal notranslate"><span class="pre">Commands</span></code> we use <code class="docutils literal notranslate"><span class="pre">createCmd</span></code> instead of
<code class="docutils literal notranslate"><span class="pre">create</span></code> and <code class="docutils literal notranslate"><span class="pre">exerciseCmd</span></code> instead of <code class="docutils literal notranslate"><span class="pre">exercise</span></code>.</p>
<div class="highlight-daml notranslate"><div class="highlight"><pre><span></span>  <span class="p">(</span><span class="n">coinProposalAlice</span><span class="p">,</span> <span class="n">coinProposalBob</span><span class="p">,</span> <span class="n">coinProposalBank</span><span class="p">)</span> <span class="ow">&lt;-</span> <span class="n">submit</span> <span class="n">parties</span><span class="o">.</span><span class="n">bank</span> <span class="o">$</span> <span class="kr">do</span>
    <span class="n">coinProposalAlice</span> <span class="ow">&lt;-</span> <span class="n">createCmd</span> <span class="p">(</span><span class="kt">CoinProposal</span> <span class="p">(</span><span class="kt">Coin</span> <span class="n">parties</span><span class="o">.</span><span class="n">bank</span> <span class="n">parties</span><span class="o">.</span><span class="n">alice</span><span class="p">))</span>
    <span class="n">coinProposalBob</span> <span class="ow">&lt;-</span> <span class="n">createCmd</span> <span class="p">(</span><span class="kt">CoinProposal</span> <span class="p">(</span><span class="kt">Coin</span> <span class="n">parties</span><span class="o">.</span><span class="n">bank</span> <span class="n">parties</span><span class="o">.</span><span class="n">bob</span><span class="p">))</span>
    <span class="n">coinProposalBank</span> <span class="ow">&lt;-</span> <span class="n">createCmd</span> <span class="p">(</span><span class="kt">CoinProposal</span> <span class="p">(</span><span class="kt">Coin</span> <span class="n">parties</span><span class="o">.</span><span class="n">bank</span> <span class="n">parties</span><span class="o">.</span><span class="n">bank</span><span class="p">))</span>
    <span class="n">pure</span> <span class="p">(</span><span class="n">coinProposalAlice</span><span class="p">,</span> <span class="n">coinProposalBob</span><span class="p">,</span> <span class="n">coinProposalBank</span><span class="p">)</span>
</pre></div>
</div>
<p>Now that we have created the <code class="docutils literal notranslate"><span class="pre">CoinProposal</span></code>s, we want <code class="docutils literal notranslate"><span class="pre">Alice</span></code> and
<code class="docutils literal notranslate"><span class="pre">Bob</span></code> to accept the proposal while the <code class="docutils literal notranslate"><span class="pre">Bank</span></code> will ignore the
proposal that it has created for itself. To do so we use separate
<code class="docutils literal notranslate"><span class="pre">submit</span></code> statements for <code class="docutils literal notranslate"><span class="pre">Alice</span></code> and <code class="docutils literal notranslate"><span class="pre">Bob</span></code> and call
<code class="docutils literal notranslate"><span class="pre">exerciseCmd</span></code>.</p>
<div class="highlight-daml notranslate"><div class="highlight"><pre><span></span>  <span class="n">coinAlice</span> <span class="ow">&lt;-</span> <span class="n">submit</span> <span class="n">parties</span><span class="o">.</span><span class="n">alice</span> <span class="o">$</span> <span class="n">exerciseCmd</span> <span class="n">coinProposalAlice</span> <span class="kt">Accept</span>
  <span class="n">coinBob</span> <span class="ow">&lt;-</span> <span class="n">submit</span> <span class="n">parties</span><span class="o">.</span><span class="n">bob</span> <span class="o">$</span> <span class="n">exerciseCmd</span> <span class="n">coinProposalBob</span> <span class="kt">Accept</span>
</pre></div>
</div>
<p>Finally, we call <code class="docutils literal notranslate"><span class="pre">pure</span> <span class="pre">()</span></code> on the last line of our script to match
the type <code class="docutils literal notranslate"><span class="pre">Script</span> <span class="pre">()</span></code>.</p>
<div class="highlight-daml notranslate"><div class="highlight"><pre><span></span>  <span class="n">pure</span> <span class="nb">()</span>
</pre></div>
</div>
<div class="section" id="party-management">
<h3>Party management<a class="headerlink" href="#party-management" title="Permalink to this headline">¶</a></h3>
<p>We have now defined a way to initialize the ledger so we can write a
test that checks that the contracts that we expect exist afterwards.</p>
<p>First, we define the signature of our test. We will create the parties
used here in the test, so it does not take any arguments.</p>
<div class="highlight-daml notranslate"><div class="highlight"><pre><span></span><span class="nf">test</span> <span class="kt">:</span> <span class="kt">Script</span> <span class="nb">()</span>
<span class="nf">test</span> <span class="ow">=</span> <span class="kr">do</span>
</pre></div>
</div>
<p>Now, we create the parties using the <code class="docutils literal notranslate"><span class="pre">allocateParty</span></code> function. This
uses the party management service to create new parties with the given
display name. Note that the display name does not identify a party
uniquely. If you call <code class="docutils literal notranslate"><span class="pre">allocateParty</span></code> twice with the same display
name, it will create 2 different parties. This is very convenient for
testing since a new party cannot see any old contracts on the ledger
so using new parties for each test removes the need to reset the
ledger.</p>
<div class="highlight-daml notranslate"><div class="highlight"><pre><span></span>  <span class="n">alice</span> <span class="ow">&lt;-</span> <span class="n">allocateParty</span> <span class="s">&quot;Alice&quot;</span>
  <span class="n">bob</span> <span class="ow">&lt;-</span> <span class="n">allocateParty</span> <span class="s">&quot;Bob&quot;</span>
  <span class="n">bank</span> <span class="ow">&lt;-</span> <span class="n">allocateParty</span> <span class="s">&quot;Bank&quot;</span>
  <span class="kr">let</span> <span class="n">parties</span> <span class="ow">=</span> <span class="kt">LedgerParties</span> <span class="n">bank</span> <span class="n">alice</span> <span class="n">bob</span>
</pre></div>
</div>
<p>We now call the <code class="docutils literal notranslate"><span class="pre">initialize</span></code> function that we defined before on the
parties that we have just allocated.</p>
<div class="highlight-daml notranslate"><div class="highlight"><pre><span></span>  <span class="n">initialize</span> <span class="n">parties</span>
</pre></div>
</div>
<p>Another option for getting access to the relevant party ids is to use
<code class="docutils literal notranslate"><span class="pre">listKnownParties</span></code> to pick out the party with a given display
name. This is mainly useful in demo scenarios because display names
are not guaranteed to be unique.</p>
<div class="highlight-daml notranslate"><div class="highlight"><pre><span></span><span class="nf">queryParties</span> <span class="kt">:</span> <span class="kt">Script</span> <span class="p">(</span><span class="kt">Optional</span> <span class="kt">LedgerParties</span><span class="p">)</span>
<span class="nf">queryParties</span> <span class="ow">=</span> <span class="kr">do</span>
  <span class="n">knownParties</span> <span class="ow">&lt;-</span> <span class="n">listKnownParties</span>
  <span class="n">pure</span> <span class="o">$</span> <span class="kr">do</span>
    <span class="n">bank</span> <span class="ow">&lt;-</span> <span class="n">party</span> <span class="o">&lt;$&gt;</span> <span class="n">find</span> <span class="p">(</span><span class="nf">\</span><span class="n">p</span> <span class="ow">-&gt;</span> <span class="n">p</span><span class="o">.</span><span class="n">displayName</span> <span class="o">==</span> <span class="kt">Some</span> <span class="s">&quot;Bank&quot;</span><span class="p">)</span> <span class="n">knownParties</span>
    <span class="n">alice</span> <span class="ow">&lt;-</span> <span class="n">party</span> <span class="o">&lt;$&gt;</span> <span class="n">find</span> <span class="p">(</span><span class="nf">\</span><span class="n">p</span> <span class="ow">-&gt;</span> <span class="n">p</span><span class="o">.</span><span class="n">displayName</span> <span class="o">==</span> <span class="kt">Some</span> <span class="s">&quot;Alice&quot;</span><span class="p">)</span> <span class="n">knownParties</span>
    <span class="n">bob</span> <span class="ow">&lt;-</span> <span class="n">party</span> <span class="o">&lt;$&gt;</span> <span class="n">find</span> <span class="p">(</span><span class="nf">\</span><span class="n">p</span> <span class="ow">-&gt;</span> <span class="n">p</span><span class="o">.</span><span class="n">displayName</span> <span class="o">==</span> <span class="kt">Some</span> <span class="s">&quot;Bob&quot;</span><span class="p">)</span> <span class="n">knownParties</span>
    <span class="n">pure</span> <span class="kt">LedgerParties</span><span class="p">{</span><span class="o">..</span><span class="p">}</span>

<span class="nf">initializeFromQuery</span> <span class="kt">:</span> <span class="kt">Script</span> <span class="nb">()</span>
<span class="nf">initializeFromQuery</span> <span class="ow">=</span> <span class="kr">do</span>
  <span class="n">optParties</span> <span class="ow">&lt;-</span> <span class="n">queryParties</span>
  <span class="kr">case</span> <span class="n">optParties</span> <span class="kr">of</span>
    <span class="kt">None</span> <span class="ow">-&gt;</span> <span class="n">fail</span> <span class="s">&quot;Could not find parties with correct display names&quot;</span>
    <span class="kt">Some</span> <span class="n">parties</span> <span class="ow">-&gt;</span> <span class="n">initialize</span> <span class="n">parties</span>
</pre></div>
</div>
</div>
<div class="section" id="queries">
<h3>Queries<a class="headerlink" href="#queries" title="Permalink to this headline">¶</a></h3>
<p>To verify the contracts on the ledger, we use the <code class="docutils literal notranslate"><span class="pre">query</span></code>
function. We pass it the type of the template and a party. It will
then give us all active contracts of the given type visible to the
party. In our example, we expect to see one active <code class="docutils literal notranslate"><span class="pre">CoinProposal</span></code>
for <code class="docutils literal notranslate"><span class="pre">bank</span></code> and one <code class="docutils literal notranslate"><span class="pre">Coin</span></code> contract for each of <code class="docutils literal notranslate"><span class="pre">Alice</span></code> and
<code class="docutils literal notranslate"><span class="pre">Bob</span></code>. We get back list of <code class="docutils literal notranslate"><span class="pre">(ContractId</span> <span class="pre">t,</span> <span class="pre">t)</span></code> pairs from
<code class="docutils literal notranslate"><span class="pre">query</span></code>. In our tests, we do not need the contract ids, so we throw
them away using <code class="docutils literal notranslate"><span class="pre">map</span> <span class="pre">snd</span></code>.</p>
<div class="highlight-daml notranslate"><div class="highlight"><pre><span></span>  <span class="n">proposals</span> <span class="ow">&lt;-</span> <span class="n">query</span> <span class="o">@</span><span class="kt">CoinProposal</span> <span class="n">bank</span>
  <span class="n">assertEq</span> <span class="p">[</span><span class="kt">CoinProposal</span> <span class="p">(</span><span class="kt">Coin</span> <span class="n">bank</span> <span class="n">bank</span><span class="p">)]</span> <span class="p">(</span><span class="n">map</span> <span class="n">snd</span> <span class="n">proposals</span><span class="p">)</span>

  <span class="n">aliceCoins</span> <span class="ow">&lt;-</span> <span class="n">query</span> <span class="o">@</span><span class="kt">Coin</span> <span class="n">alice</span>
  <span class="n">assertEq</span> <span class="p">[</span><span class="kt">Coin</span> <span class="n">bank</span> <span class="n">alice</span><span class="p">]</span> <span class="p">(</span><span class="n">map</span> <span class="n">snd</span> <span class="n">aliceCoins</span><span class="p">)</span>

  <span class="n">bobCoins</span> <span class="ow">&lt;-</span> <span class="n">query</span> <span class="o">@</span><span class="kt">Coin</span> <span class="n">bob</span>
  <span class="n">assertEq</span> <span class="p">[</span><span class="kt">Coin</span> <span class="n">bank</span> <span class="n">bob</span><span class="p">]</span> <span class="p">(</span><span class="n">map</span> <span class="n">snd</span> <span class="n">bobCoins</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="running-a-script">
<h3>Running a Script<a class="headerlink" href="#running-a-script" title="Permalink to this headline">¶</a></h3>
<p>To run our script, we first build it with <code class="docutils literal notranslate"><span class="pre">daml</span> <span class="pre">build</span></code> and then run
it by pointing to the DAR, the name of our script, and the host and
port our ledger is running on.</p>
<p><code class="docutils literal notranslate"><span class="pre">daml</span> <span class="pre">script</span> <span class="pre">--dar</span> <span class="pre">.daml/dist/script-example-0.0.1.dar</span> <span class="pre">--script-name</span> <span class="pre">ScriptExample:test</span> <span class="pre">--ledger-host</span> <span class="pre">localhost</span> <span class="pre">--ledger-port</span> <span class="pre">6865</span></code></p>
<p>Up to now, we have worked with a script (<code class="docutils literal notranslate"><span class="pre">test</span></code>) that is entirely
self-contained. This is fine for running unit-test type scenarios in the IDE,
but for more complex use-cases you may want to vary the inputs of a script and
inspect its outputs, ideally without having to recompile it. To that end, the
<code class="docutils literal notranslate"><span class="pre">daml</span> <span class="pre">script</span></code> command supports the flags <code class="docutils literal notranslate"><span class="pre">--input-file</span></code> and
<code class="docutils literal notranslate"><span class="pre">--output-file</span></code>. Both flags take a filename, and said file will be
read/written as JSON, following the <a class="reference internal" href="../json-api/lf-value-specification.html"><span class="doc">Daml-LF JSON Encoding</span></a>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">--output-file</span></code> option instructs <code class="docutils literal notranslate"><span class="pre">daml</span> <span class="pre">script</span></code> to write the result of
the given <code class="docutils literal notranslate"><span class="pre">--script-name</span></code> to the given filename (creating the file if it does
not exist; overwriting it otherwise). This is most usfeful if the given program
has a type <code class="docutils literal notranslate"><span class="pre">Script</span> <span class="pre">b</span></code>, where <code class="docutils literal notranslate"><span class="pre">b</span></code> is a meaningful value, which is not the
case here: all of our <code class="docutils literal notranslate"><span class="pre">Script</span></code> programs have type <code class="docutils literal notranslate"><span class="pre">Script</span> <span class="pre">()</span></code>.</p>
<p>If the <code class="docutils literal notranslate"><span class="pre">--input-file</span></code> flag is specified, the <code class="docutils literal notranslate"><span class="pre">--script-name</span></code> flag must
point to a function of one argument returning a <code class="docutils literal notranslate"><span class="pre">Script</span></code>, and the function
will be called with the result of parsing the input file as its argument. For
example, we can initialize our ledger using the <code class="docutils literal notranslate"><span class="pre">initialize</span></code> function defined
above. It takes a <code class="docutils literal notranslate"><span class="pre">LedgerParties</span></code> argument, so a valid file for
<code class="docutils literal notranslate"><span class="pre">--input-file</span></code> would look like:</p>
<div class="highlight-daml notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s">&quot;alice&quot;</span><span class="kt">:</span> <span class="s">&quot;Alice&quot;</span><span class="p">,</span>
  <span class="s">&quot;bob&quot;</span><span class="kt">:</span> <span class="s">&quot;Bob&quot;</span><span class="p">,</span>
  <span class="s">&quot;bank&quot;</span><span class="kt">:</span> <span class="s">&quot;Bank&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Using that file, we can initialize our ledger passing it in via <code class="docutils literal notranslate"><span class="pre">--input-file</span></code>:</p>
<p><code class="docutils literal notranslate"><span class="pre">daml</span> <span class="pre">script</span> <span class="pre">--dar</span> <span class="pre">.daml/dist/script-example-0.0.1.dar</span> <span class="pre">--script-name</span> <span class="pre">ScriptExample:initialize</span> <span class="pre">--ledger-host</span> <span class="pre">localhost</span> <span class="pre">--ledger-port</span> <span class="pre">6865</span> <span class="pre">--input-file</span> <span class="pre">ledger-parties.json</span></code></p>
<p>If you open Navigator, you can now see the contracts that have been created.</p>
</div>
</div>
<div class="section" id="using-daml-script-for-ledger-initialization">
<span id="script-ledger-initialization"></span><h2>Using Daml Script for Ledger Initialization<a class="headerlink" href="#using-daml-script-for-ledger-initialization" title="Permalink to this headline">¶</a></h2>
<p>You can use Daml script to initialize a ledger on startup. To do so,
specify an <code class="docutils literal notranslate"><span class="pre">init-script:</span> <span class="pre">ScriptExample:initializeFixed</span></code> field in
your <code class="docutils literal notranslate"><span class="pre">daml.yaml</span></code>. This will automatically be picked up by <code class="docutils literal notranslate"><span class="pre">daml</span>
<span class="pre">start</span></code> and used to initialize sandbox. Since it is often useful to
create a party with a specific party identifier during development, you can
use the <code class="docutils literal notranslate"><span class="pre">allocatePartyWithHint</span></code> function which accepts not only the
display name but also a hint for the party identifier. On Sandbox, the hint
will be used directly as the party identifier of the newly allocated
party. This allows us to implement <code class="docutils literal notranslate"><span class="pre">initializeFixed</span></code> as a small
wrapper around the <code class="docutils literal notranslate"><span class="pre">initialize</span></code> function we defined above:</p>
<div class="highlight-daml notranslate"><div class="highlight"><pre><span></span><span class="nf">initializeFixed</span> <span class="kt">:</span> <span class="kt">Script</span> <span class="nb">()</span>
<span class="nf">initializeFixed</span> <span class="ow">=</span> <span class="kr">do</span>
  <span class="n">bank</span> <span class="ow">&lt;-</span> <span class="n">allocatePartyWithHint</span> <span class="s">&quot;Bank&quot;</span> <span class="p">(</span><span class="kt">PartyIdHint</span> <span class="s">&quot;Bank&quot;</span><span class="p">)</span>
  <span class="n">alice</span> <span class="ow">&lt;-</span> <span class="n">allocatePartyWithHint</span> <span class="s">&quot;Alice&quot;</span> <span class="p">(</span><span class="kt">PartyIdHint</span> <span class="s">&quot;Alice&quot;</span><span class="p">)</span>
  <span class="n">bob</span> <span class="ow">&lt;-</span> <span class="n">allocatePartyWithHint</span> <span class="s">&quot;Bob&quot;</span> <span class="p">(</span><span class="kt">PartyIdHint</span> <span class="s">&quot;Bob&quot;</span><span class="p">)</span>
  <span class="kr">let</span> <span class="n">parties</span> <span class="ow">=</span> <span class="kt">LedgerParties</span><span class="p">{</span><span class="o">..</span><span class="p">}</span>
  <span class="n">initialize</span> <span class="n">parties</span>
</pre></div>
</div>
<div class="section" id="migrating-from-scenarios">
<h3>Migrating from Scenarios<a class="headerlink" href="#migrating-from-scenarios" title="Permalink to this headline">¶</a></h3>
<p>Existing scenarios that you used for ledger initialization can be
translated to Daml script but there are a few things to keep in mind:</p>
<ol class="arabic simple">
<li>You need to add <code class="docutils literal notranslate"><span class="pre">daml-script</span></code> to the list of dependencies in your
<code class="docutils literal notranslate"><span class="pre">daml.yaml</span></code>.</li>
<li>You need to import the <code class="docutils literal notranslate"><span class="pre">Daml.Script</span></code> module.</li>
<li>Calls to <code class="docutils literal notranslate"><span class="pre">create</span></code>, <code class="docutils literal notranslate"><span class="pre">exercise</span></code>, <code class="docutils literal notranslate"><span class="pre">exerciseByKey</span></code> and
<code class="docutils literal notranslate"><span class="pre">createAndExercise</span></code> need to be suffixed with <code class="docutils literal notranslate"><span class="pre">Cmd</span></code>, e.g.,
<code class="docutils literal notranslate"><span class="pre">createCmd</span></code>.</li>
<li>Instead of specifying a <code class="docutils literal notranslate"><span class="pre">scenario</span></code> field in your <code class="docutils literal notranslate"><span class="pre">daml.yaml</span></code>,
you need to specify an <code class="docutils literal notranslate"><span class="pre">init-script</span></code> field. The initialization
script is specified via <code class="docutils literal notranslate"><span class="pre">Module:identifier</span></code> for both fields.</li>
<li>In Daml script, <code class="docutils literal notranslate"><span class="pre">submit</span></code> and <code class="docutils literal notranslate"><span class="pre">submitMustFail</span></code> are limited to
the functionality provided by the ledger API: A list of independent
commands consisting of <code class="docutils literal notranslate"><span class="pre">createCmd</span></code>, <code class="docutils literal notranslate"><span class="pre">exerciseCmd</span></code>,
<code class="docutils literal notranslate"><span class="pre">createAndExerciseCmd</span></code> and <code class="docutils literal notranslate"><span class="pre">exerciseByKeyCmd</span></code>. There are two
issues you might run into when migrating an existing scenario:<ol class="arabic">
<li>Your commands depend on each other, e.g., you use the result of
a <code class="docutils literal notranslate"><span class="pre">create</span></code> within a following command in the same
<code class="docutils literal notranslate"><span class="pre">submit</span></code>. In this case, you have two options: If it is not
important that they are part of a single transaction, split
them into multiple calls to <code class="docutils literal notranslate"><span class="pre">submit</span></code>. If you do need them to
be within the same transaction, you can move the logic to a
choice and call that using <code class="docutils literal notranslate"><span class="pre">createAndExerciseCmd</span></code>.</li>
<li>You use something that is not part of the 4 ledger API command
types, e.g., <code class="docutils literal notranslate"><span class="pre">fetch</span></code>. For <code class="docutils literal notranslate"><span class="pre">fetch</span></code> and <code class="docutils literal notranslate"><span class="pre">fetchByKey</span></code>, you
can instead use <code class="docutils literal notranslate"><span class="pre">queryContractId</span></code> and <code class="docutils literal notranslate"><span class="pre">queryContractKey</span></code>
with the caveat that they do not run within the same
transaction. Other types of <code class="docutils literal notranslate"><span class="pre">Update</span></code> statements can be moved
to a choice that you call via <code class="docutils literal notranslate"><span class="pre">createAndExerciseCmd</span></code>.</li>
</ol>
</li>
<li>Instead of Scenario’s <code class="docutils literal notranslate"><span class="pre">getParty</span></code>, Daml Script provides you with
<code class="docutils literal notranslate"><span class="pre">allocateParty</span></code> and <code class="docutils literal notranslate"><span class="pre">allocatePartyWithHint</span></code>. There are a few
important differences:<ol class="arabic">
<li>Allocating a party always gives you back a new party (or
fails). If you have multiple calls to <code class="docutils literal notranslate"><span class="pre">getParty</span></code> with the same
string and expect to get back the same party, you should instead
allocate the party once at the beginning and pass it along to
the rest of the code.</li>
<li>If you want to allocate a party with a specific party id, you
can use <code class="docutils literal notranslate"><span class="pre">allocatePartyWithHint</span> <span class="pre">x</span> <span class="pre">(PartyIdHint</span> <span class="pre">x)</span></code> as a replacement for <cite>getParty x</cite>. Note that
while this is supported in Daml Studio and Daml for PostgreSQL, other
ledgers can behave differently and ignore the party id hint or
interpret it another way. Try to not rely on any specific
party id.</li>
</ol>
</li>
<li>Instead of <code class="docutils literal notranslate"><span class="pre">pass</span></code> and <code class="docutils literal notranslate"><span class="pre">passToDate</span></code>, Daml Script provides
<code class="docutils literal notranslate"><span class="pre">passTime</span></code> and <code class="docutils literal notranslate"><span class="pre">setTime</span></code>.</li>
</ol>
</div>
</div>
<div class="section" id="using-daml-script-in-distributed-topologies">
<span id="daml-script-distributed"></span><h2>Using Daml Script in Distributed Topologies<a class="headerlink" href="#using-daml-script-in-distributed-topologies" title="Permalink to this headline">¶</a></h2>
<p>So far, we have run Daml script against a single participant node. It
is also more possible to run it in a setting where different parties
are hosted on different participant nodes. To do so, pass the
<code class="docutils literal notranslate"><span class="pre">--participant-config</span> <span class="pre">participants.json</span></code> file to <code class="docutils literal notranslate"><span class="pre">daml</span> <span class="pre">script</span></code>
instead of <code class="docutils literal notranslate"><span class="pre">--ledger-host</span></code> and <code class="docutils literal notranslate"><span class="pre">ledger-port</span></code>. The file should be of the format</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;default_participant&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nt">&quot;host&quot;</span><span class="p">:</span> <span class="s2">&quot;localhost&quot;</span><span class="p">,</span> <span class="nt">&quot;port&quot;</span><span class="p">:</span> <span class="mi">6866</span><span class="p">,</span> <span class="nt">&quot;access_token&quot;</span><span class="p">:</span> <span class="s2">&quot;default_jwt&quot;</span><span class="p">,</span> <span class="nt">&quot;application_id&quot;</span><span class="p">:</span> <span class="s2">&quot;myapp&quot;</span><span class="p">},</span>
    <span class="nt">&quot;participants&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;one&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nt">&quot;host&quot;</span><span class="p">:</span> <span class="s2">&quot;localhost&quot;</span><span class="p">,</span> <span class="nt">&quot;port&quot;</span><span class="p">:</span> <span class="mi">6865</span><span class="p">,</span> <span class="nt">&quot;access_token&quot;</span><span class="p">:</span> <span class="s2">&quot;jwt_for_alice&quot;</span><span class="p">,</span> <span class="nt">&quot;application_id&quot;</span><span class="p">:</span> <span class="s2">&quot;myapp&quot;</span><span class="p">},</span>
        <span class="nt">&quot;two&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nt">&quot;host&quot;</span><span class="p">:</span> <span class="s2">&quot;localhost&quot;</span><span class="p">,</span> <span class="nt">&quot;port&quot;</span><span class="p">:</span> <span class="mi">6865</span><span class="p">,</span> <span class="nt">&quot;access_token&quot;</span><span class="p">:</span> <span class="s2">&quot;jwt_for_bob&quot;</span><span class="p">,</span> <span class="nt">&quot;application_id&quot;</span><span class="p">:</span> <span class="s2">&quot;myapp&quot;</span><span class="p">}</span>
    <span class="p">},</span>
    <span class="nt">&quot;party_participants&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nt">&quot;alice&quot;</span><span class="p">:</span> <span class="s2">&quot;one&quot;</span><span class="p">,</span> <span class="nt">&quot;bob&quot;</span><span class="p">:</span> <span class="s2">&quot;two&quot;</span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This will define a participant called <code class="docutils literal notranslate"><span class="pre">one</span></code>, a default participant
and it defines that the party <code class="docutils literal notranslate"><span class="pre">alice</span></code> is on participant
<code class="docutils literal notranslate"><span class="pre">one</span></code>. Whenever you submit something as party, we will use the
participant for that party or if none is specified
<code class="docutils literal notranslate"><span class="pre">default_participant</span></code>. If <code class="docutils literal notranslate"><span class="pre">default_participant</span></code> is not specified,
using a party with an unspecified participant is an error.</p>
<p><code class="docutils literal notranslate"><span class="pre">allocateParty</span></code> will also use the <code class="docutils literal notranslate"><span class="pre">default_participant</span></code>. If you
want to allocate a party on a specific participant, you can use
<code class="docutils literal notranslate"><span class="pre">allocatePartyOn</span></code> which accepts the participant name as an extra
argument.</p>
</div>
<div class="section" id="running-daml-script-against-ledgers-with-authorization">
<span id="daml-script-auth"></span><h2>Running Daml Script against Ledgers with Authorization<a class="headerlink" href="#running-daml-script-against-ledgers-with-authorization" title="Permalink to this headline">¶</a></h2>
<p>To run Daml Script against a ledger that verifies authorization,
you need to specify an access token. There are two ways of doing that:</p>
<ol class="arabic simple">
<li>Specify a single access token via <code class="docutils literal notranslate"><span class="pre">--access-token-file</span>
<span class="pre">path/to/jwt</span></code>. This token will then be used for all requests so it
must provide claims for all parties that you use in your script.</li>
<li>If you need multiple tokens, e.g., because you only have
single-party tokens you can use the <code class="docutils literal notranslate"><span class="pre">access_token</span></code> field in the
participant config specified via <code class="docutils literal notranslate"><span class="pre">--participant-config</span></code>. The
section on
<a class="reference internal" href="#daml-script-distributed"><span class="std std-ref">using Daml Script in distributed topologies</span></a>
contains an example. Note that you can specify the same participant
twice if you want different auth tokens.</li>
</ol>
<p>If you specify both <code class="docutils literal notranslate"><span class="pre">--access-token-file</span></code> and
<code class="docutils literal notranslate"><span class="pre">--participant-config</span></code>, the participant config takes precedence and
the token from the file will be used for any participant that does not
have a token specified in the config.</p>
</div>
<div class="section" id="running-daml-script-against-the-http-json-api">
<span id="daml-script-json-api"></span><h2>Running Daml Script against the HTTP JSON API<a class="headerlink" href="#running-daml-script-against-the-http-json-api" title="Permalink to this headline">¶</a></h2>
<p>In some cases, you only have access to the
<a class="reference internal" href="../json-api/index.html"><span class="doc">HTTP JSON API</span></a> but not to the gRPC of a ledger, e.g., on
<a class="reference external" href="https://hub.daml.com">Daml Hub</a>. For this usecase, Daml
script can be run against the JSON API. Note that if you do have
access to the gRPC Ledger API, running Daml script against the JSON API does
not have any advantages.</p>
<p>To run Daml script against the JSON API you have to pass the <code class="docutils literal notranslate"><span class="pre">--json-api</span></code> parameter to <code class="docutils literal notranslate"><span class="pre">daml</span> <span class="pre">script</span></code>. There are a few differences and limitations compared to running Daml Script against the gRPC Ledger API:</p>
<ol class="arabic simple">
<li>When running against the JSON API, the <code class="docutils literal notranslate"><span class="pre">--host</span></code> argument has to
contain an <code class="docutils literal notranslate"><span class="pre">http://</span></code> or <code class="docutils literal notranslate"><span class="pre">https://</span></code> prefix, e.g., <code class="docutils literal notranslate"><span class="pre">daml</span>
<span class="pre">script</span> <span class="pre">--host</span> <span class="pre">http://localhost</span> <span class="pre">--port</span> <span class="pre">7575</span> <span class="pre">--json-api</span></code>.</li>
<li>The JSON API only supports single-command submissions. This means
that within a single call to <code class="docutils literal notranslate"><span class="pre">submit</span></code> you can only execute one
ledger API command, e.g., one <code class="docutils literal notranslate"><span class="pre">createCmd</span></code> or one <code class="docutils literal notranslate"><span class="pre">exerciseCmd</span></code>.</li>
<li>The JSON API requires authorization tokens even when it is run
against a ledger that doesn’t verify authorization. The section on
<a class="reference internal" href="#daml-script-auth"><span class="std std-ref">authorization</span></a> describes how to specify
the tokens.</li>
<li>The parties used for command submissions and queries must match the
parties specified in the token exactly.  For command submissions
that means <code class="docutils literal notranslate"><span class="pre">actAs</span></code> and <code class="docutils literal notranslate"><span class="pre">readAs</span></code> must match exactly what you
specified whereas for queries the union of <code class="docutils literal notranslate"><span class="pre">actAs</span></code> and <code class="docutils literal notranslate"><span class="pre">readAs</span></code>
must match the parties specified in the query.</li>
<li>If you use multiple parties within your Daml Script, you need to
specify one token per party or every submission and query must
specify all parties of the multi-party token.</li>
<li><code class="docutils literal notranslate"><span class="pre">getTime</span></code> will always return the Unix epoch in static time mode
since the time service is not exposed via the JSON API.</li>
<li><code class="docutils literal notranslate"><span class="pre">setTime</span></code> is not supported and will throw a runtime error.</li>
</ol>
</div>
</div>


              
            </div>
            
            
              <!-- Copyright (c) 2021 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved. -->
<!-- SPDX-License-Identifier: Apache-2.0 -->

<footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../json-api/production-setup.html" class="da-btn da-btn-label btn-prev" title="Production Setup" accesskey="p" rel="prev">Previous</a>
      
      
        <a href="../daml-repl/index.html" class="da-btn da-btn-label btn-next" title="Daml REPL" accesskey="n" rel="next">Next</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        Copyright (c) 2021 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved. Any unauthorized use, duplication or distribution is strictly prohibited. &#34;Digital Asset&#34; and &#34;Daml&#34; are Registered in the U.S. Patent and Trademark Office.

    </p>
  </div> 

</footer>
            
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- Copyright (c) 2021 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved. -->
<!-- SPDX-License-Identifier: Apache-2.0 -->





  <script type="text/javascript">
    jQuery(function () {
      SphinxRtdTheme.Navigation.enable(true);
      });
  </script>


  
    
  
  <div id="inpageContent"></div>
  

</body>
</html>