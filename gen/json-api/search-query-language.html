<!-- Copyright (c) 2021 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved. -->
<!-- SPDX-License-Identifier: Apache-2.0 -->



<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->

<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Query language &mdash; Daml SDK __VERSION__ documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
  
  <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
  <script type="text/javascript" src="../_static/jquery.js"></script>
  <script type="text/javascript" src="../_static/underscore.js"></script>
  <script type="text/javascript" src="../_static/doctools.js"></script>
  <script type="text/javascript" src="../_static/language_data.js"></script>
  <script type="text/javascript" src="../_static/clipboard.min.js"></script>
  <script type="text/javascript" src="../_static/copybutton.js"></script>
  
  <script type="text/javascript" src="../_static/js/theme.js"></script>

  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
  <link rel="index" title="Index" href="../genindex.html" />
  <link rel="search" title="Search" href="../search.html" />
  <link rel="next" title="Production Setup" href="production-setup.html" />
  <link rel="prev" title="Daml-LF JSON Encoding" href="lf-value-specification.html" /> 

  
  <link rel="icon" type="image/svg+xml"  href="../_static/images/daml-logo-mark-light.svg">
  <link rel="alternate icon" href="../_static/images/daml-favicon-1.ico">

  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-MSWJMNX');</script>
  <!-- End Google Tag Manager -->

  
  <!-- Mopinion Pastea.se  start --><script type="text/javascript">(function(){var id="4s6vwov7ad6qyxhq8iwbyhocrsn2nm36k25";var js=document.createElement("script");js.setAttribute("type","text/javascript");js.setAttribute("src","//deploy.mopinion.com/js/pastease.js");js.async=true;document.getElementsByTagName("head")[0].appendChild(js);var t=setInterval(function(){try{new Pastease.load(id);clearInterval(t)}catch(e){}},50)})();</script><!-- Mopinion Pastea.se end -->
</head>

<body class="wy-body-for-nav">
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MSWJMNX"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->
   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-nav-side-shadow"></div>
      <div class="wy-side-scroll">

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
          
          
          
          
          
          <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Daml Documentation</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting-started/installation.html">Installing the SDK</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../getting-started/path-variables.html">Setting JAVA_HOME and PATH variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting-started/manual-download.html">Manually installing the SDK</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started/index.html">Building Your App</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started/app-architecture.html">App Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started/first-feature.html">Your First Feature</a></li>
<li class="toctree-l1"><a class="reference external" href="https://docs.daml.com/cheat-sheet">Cheat Sheet</a></li>
</ul>
<p class="caption"><span class="caption-text">Writing Daml</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../daml/intro/0_Intro.html">An introduction to Daml</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../daml/intro/1_Token.html">1 Basic contracts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/intro/2_DamlScript.html">2 Testing templates using Daml Script</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/intro/3_Data.html">3 Data types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/intro/4_Transformations.html">4 Transforming data using choices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/intro/5_Restrictions.html">5 Adding constraints to a contract</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/intro/6_Parties.html">6 Parties and authority</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/intro/7_Composing.html">7 Composing choices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/intro/8_Exceptions.html">8 Exception Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/intro/9_Dependencies.html">9 Working with Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/intro/10_Functional101.html">10 Functional Programming 101</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/intro/11_StdLib.html">11 Intro to the Daml Standard Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/intro/12_Testing.html">12 Testing Daml Contracts</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../daml/reference/index.html">Language reference docs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../daml/reference/structure.html">Overview: template structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/reference/templates.html">Templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/reference/choices.html">Choices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/reference/updates.html">Updates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/reference/data-types.html">Data types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/reference/working-with.html">Built-in functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/reference/expressions.html">Expressions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/reference/functions.html">Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/reference/scenarios.html">Scenarios</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/reference/file-structure.html">File structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/reference/packages.html">Packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/reference/contract-keys.html">Contract keys</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/reference/exceptions.html">Exceptions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../daml/troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../daml/patterns.html">Good design patterns</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../daml/patterns/initaccept.html">Initiate and Accept</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/patterns/multiparty-agreement.html">Multiple party agreement</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/patterns/delegation.html">Delegation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/patterns/authorization.html">Authorization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/patterns/locking.html">Locking</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../daml/patterns/locking/locking-by-archiving.html">Locking by archiving</a></li>
<li class="toctree-l3"><a class="reference internal" href="../daml/patterns/locking/locking-by-state.html">Locking by state</a></li>
<li class="toctree-l3"><a class="reference internal" href="../daml/patterns/locking/locking-by-safekeeping.html">Locking by safekeeping</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../daml/patterns/legends.html">Diagram legends</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Building applications</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../app-dev/app-arch.html">Application architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../app-dev/bindings-ts/index.html">JavaScript Client Libraries</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../app-dev/bindings-ts/daml2js.html">JavaScript Code Generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../app-dev/bindings-ts/daml-react.html">&#64;daml/react</a></li>
<li class="toctree-l2"><a class="reference internal" href="../app-dev/bindings-ts/daml-ledger.html">&#64;daml/ledger</a></li>
<li class="toctree-l2"><a class="reference internal" href="../app-dev/bindings-ts/daml-types.html">&#64;daml/types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../app-dev/bindings-ts/testing.html">Testing Your Web App</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">HTTP JSON API Service</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="lf-value-specification.html">Daml-LF JSON Encoding</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Query language</a></li>
<li class="toctree-l2"><a class="reference internal" href="production-setup.html">Production Setup</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../daml-script/index.html">Daml Script</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../daml-repl/index.html">Daml REPL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../upgrade/index.html">Upgrading and Extending Daml applications</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../upgrade/extend.html">Extending Daml applications</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../upgrade/upgrade.html">Upgrading Daml applications</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../upgrade/automation.html">Automating the Upgrade Process</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../app-dev/authorization.html">Authorization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../app-dev/ledger-api.html">The Ledger API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../app-dev/services.html">The Ledger API services</a></li>
<li class="toctree-l2"><a class="reference internal" href="../app-dev/grpc/index.html">gRPC</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../app-dev/grpc/error-codes.html">Error Codes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../app-dev/grpc/daml-to-ledger-api.html">How Daml types are translated to protobuf</a></li>
<li class="toctree-l2"><a class="reference internal" href="../app-dev/daml-lf-translation.html">How Daml types are translated to Daml-LF</a></li>
<li class="toctree-l2"><a class="reference internal" href="../app-dev/bindings-java/index.html">Java bindings</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../app-dev/bindings-java/codegen.html">Generate Java code from Daml</a></li>
<li class="toctree-l3"><a class="reference internal" href="../app-dev/bindings-java/example.html">Ping Pong Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="../app-dev/bindings-java/quickstart.html">Iou Quickstart Tutorial</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../app-dev/bindings-scala/index.html">Scala bindings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../app-dev/bindings-js.html">Node.js bindings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../app-dev/bindings-x-lang/index.html">Creating your own bindings</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../triggers/index.html">Daml Triggers - Off-Ledger Automation in Daml</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tools/trigger-service/index.html">Trigger Service</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tools/trigger-service/authorization.html">Authorization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tools/trigger-service/auth0_example.html">Auth0 Example Configuration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tools/auth-middleware/index.html">Auth Middleware</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tools/auth-middleware/oauth2.html">OAuth 2.0 Auth Middleware</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Deploying to Daml ledgers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../deploy/index.html">Overview of Daml ledgers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deploy/generic_ledger.html">Deploying to a generic Daml ledger</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deploy/ledger-topologies.html">Daml Ledger Topologies</a></li>
</ul>
<p class="caption"><span class="caption-text">Operating Daml</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../ops/index.html">Daml Participant pruning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ops/connect/index.html">Operating Daml Connect</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../ops/connect/helm.html">Connect Helm Chart</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ops/connect/auth0.html">Setting Up Auth0</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Developer Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tools/assistant.html">Daml Assistant (<code class="docutils literal notranslate"><span class="pre">daml</span></code>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../daml/daml-studio.html">Daml Studio</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/sandbox.html">Daml Sandbox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/navigator/index.html">Navigator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/codegen.html">Daml codegen</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/profiler.html">Daml Profiler</a></li>
</ul>
<p class="caption"><span class="caption-text">Background concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../concepts/glossary.html">Glossary of concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/ledger-model/index.html">Daml Ledger Model</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../concepts/ledger-model/ledger-structure.html">Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/ledger-model/ledger-integrity.html">Integrity</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/ledger-model/ledger-privacy.html">Privacy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/ledger-model/ledger-daml.html">Daml: Defining Contract Models Compactly</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/ledger-model/ledger-exceptions.html">Exceptions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/identity-and-package-management.html">Identity and Package Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/time.html">Time</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/local-ledger.html">Causality and Local Ledgers</a></li>
</ul>
<p class="caption"><span class="caption-text">Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://daml.com/examples">Examples</a></li>
</ul>
<p class="caption"><span class="caption-text">Early Access Features</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tools/extractor.html">Extractor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/export/index.html">Ledger Export</a></li>
<li class="toctree-l1"><a class="reference internal" href="../daml-integration-kit/index.html">Daml Integration Kit</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tools/ledger-api-test-tool/index.html">Ledger API Test Tool</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tools/visual.html">Visualizing Daml Contracts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/interoperability.html">Ledger Interoperability</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/non-repudiation.html">Non-repudiation</a></li>
</ul>
<p class="caption"><span class="caption-text">Daml Ecosystem</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../support/overview.html">Daml Ecosystem Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../support/status-definitions.html">Status Definitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../support/component-statuses.html">Feature and Component Statuses</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../support/releases.html">Releases and Versioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../support/compatibility.html">Portability, Compatibility, and Support Durations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../support/support.html">Getting Help</a></li>
</ul>

          
          
          
          <div class="pdf-download"><a href="../_downloads/DigitalAssetSDK.pdf" download>Download as PDF</a></div>
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <div class="topbar fixed">
        
        <nav class="wy-nav-top" aria-label="top navigation">
          
          <i data-toggle="wy-nav-top" class="wy-nav-top-toggle"></i>
          
        </nav>
        <!-- Copyright (c) 2021 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved. -->
<!-- SPDX-License-Identifier: Apache-2.0 -->

<div class="navbar">
    <h1><img src="../_static/images/DAML_Logo_Blue.svg"></h1>
    <div class="navbar-menu">
        <div class="da-menu-item da-menu-depth-1" role="menu">
            <a href="https://www.daml.com/" role="menuitem" class="da-menu-link">Developers</a>
        </div>
        <div class="da-menu-item da-menu-depth-1" role="menu">
            <a href="https://www.digitalasset.com/products" role="menuitem" class="da-menu-link">Products</a>
        </div>
        <div class="da-menu-item da-menu-depth-1" role="menu">
            <a href="https://www.digitalasset.com" role="menuitem" class="da-menu-link">Company</a>
        </div>
    </div>
</div>

        <div class="version ">
          <span class="hide-mobile">Version&nbsp;</span><span class="version_switcher_placeholder"></span>
          
        </div>


        <!-- Copyright (c) 2021 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved. -->
<!-- SPDX-License-Identifier: Apache-2.0 -->
<div class="search-inline">
    <div id="rtd-search-inline-form" class="wy-form">
        <input type="text" class="search-inline-input" placeholder="Search" name="q">
        <img src="../_static/images/Search.svg" class="search-inline-img"/>
    </div>
    <div class="search-alert">
        Please enter at least 3 letters.
    </div>
    <div id="search-inline-results" class="search-inline-results">
        
    </div>
</div>
          <!-- Copyright (c) 2021 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved. -->
<!-- SPDX-License-Identifier: Apache-2.0 -->

<div class="content-menu collapsed">
    <span class="content-menu-title">In This Section</span>
    <span class="content-menu-expand"></span>
    <div class="content-menu-wrapper">
        
        <!-- Local TOC -->
        <div class="content-menu-toc"><ul>
<li><a class="reference internal" href="#">Query language</a><ul>
<li><a class="reference internal" href="#fallback-rule">Fallback rule</a></li>
<li><a class="reference internal" href="#simple-equality">Simple equality</a></li>
<li><a class="reference internal" href="#comparison-query">Comparison query</a></li>
<li><a class="reference internal" href="#appendix-type-aware-queries">Appendix: Type-aware queries</a></li>
<li><a class="reference internal" href="#appendix-known-issues">Appendix: Known issues</a><ul>
<li><a class="reference internal" href="#when-using-oracle-queries-fail-if-a-token-is-too-large">When using Oracle, queries fail if a token is too large</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
        
    </div>
</div>
        

      </div>
      <div class="wy-nav-content">
        
        <div class="rst-content">
          
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div itemprop="articleBody">
                
  <div class="section" id="query-language">
<h1>Query language<a class="headerlink" href="#query-language" title="Permalink to this headline">¶</a></h1>
<p>The body of <code class="docutils literal notranslate"><span class="pre">POST</span> <span class="pre">/v1/query</span></code> looks like so:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>{
    &quot;templateIds&quot;: [...template IDs...],
    &quot;query&quot;: {...query elements...}
}
</pre></div>
</div>
<p>The elements of that query are defined here.</p>
<div class="section" id="fallback-rule">
<h2>Fallback rule<a class="headerlink" href="#fallback-rule" title="Permalink to this headline">¶</a></h2>
<p>Unless otherwise required by one of the other rules below or to follow,
values are interpreted according to <a class="reference internal" href="lf-value-specification.html"><span class="doc">Daml-LF JSON Encoding</span></a>, and
compared for equality.</p>
<p>All types are supported by this simple equality comparison except:</p>
<ul class="simple">
<li>lists</li>
<li>textmaps</li>
<li>genmaps</li>
</ul>
</div>
<div class="section" id="simple-equality">
<h2>Simple equality<a class="headerlink" href="#simple-equality" title="Permalink to this headline">¶</a></h2>
<p>Match records having at least all the (potentially nested) keys
expressed in the query. The result record may contain additional
properties.</p>
<p>Example: <code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">person:</span> <span class="pre">{</span> <span class="pre">name:</span> <span class="pre">&quot;Bob&quot;</span> <span class="pre">},</span> <span class="pre">city:</span> <span class="pre">&quot;London&quot;</span> <span class="pre">}</span></code></p>
<ul class="simple">
<li>Match: <code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">person:</span> <span class="pre">{</span> <span class="pre">name:</span> <span class="pre">&quot;Bob&quot;,</span> <span class="pre">dob:</span> <span class="pre">&quot;1956-06-21&quot;</span> <span class="pre">},</span> <span class="pre">city:</span> <span class="pre">&quot;London&quot;,</span>
<span class="pre">createdAt:</span> <span class="pre">&quot;2019-04-30T12:34:12Z&quot;</span> <span class="pre">}</span></code></li>
<li>No match: <code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">person:</span> <span class="pre">{</span> <span class="pre">name:</span> <span class="pre">&quot;Bob&quot;</span> <span class="pre">},</span> <span class="pre">city:</span> <span class="pre">&quot;Zurich&quot;</span> <span class="pre">}</span></code></li>
<li>Typecheck failure: <code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">person:</span> <span class="pre">{</span> <span class="pre">name:</span> <span class="pre">[&quot;Bob&quot;,</span> <span class="pre">&quot;Sue&quot;]</span> <span class="pre">},</span> <span class="pre">city:</span>
<span class="pre">&quot;London&quot;</span> <span class="pre">}</span></code></li>
</ul>
<p>A JSON object, when considered with a record type, is always interpreted
as a field equality query. Its type context is thus mutually exclusive
with comparison queries.</p>
</div>
<div class="section" id="comparison-query">
<h2>Comparison query<a class="headerlink" href="#comparison-query" title="Permalink to this headline">¶</a></h2>
<p>Match values on comparison operators for int64, numeric, text, date, and
time values. Instead of a value, a key can be an object with one or more
operators: <code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">&lt;op&gt;:</span> <span class="pre">value</span> <span class="pre">}</span></code> where <code class="docutils literal notranslate"><span class="pre">&lt;op&gt;</span></code> can be:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">&quot;%lt&quot;</span></code> for less than</li>
<li><code class="docutils literal notranslate"><span class="pre">&quot;%gt&quot;</span></code> for greater than</li>
<li><code class="docutils literal notranslate"><span class="pre">&quot;%lte&quot;</span></code> for less than or equal to</li>
<li><code class="docutils literal notranslate"><span class="pre">&quot;%gte&quot;</span></code> for greater than or equal to</li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">&quot;%lt&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;%lte&quot;</span></code> may not be used at the same time, and likewise
with <code class="docutils literal notranslate"><span class="pre">&quot;%gt&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;%gte&quot;</span></code>, but all other combinations are allowed.</p>
<p>Example:  <code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">&quot;person&quot;</span> <span class="pre">{</span> <span class="pre">&quot;dob&quot;:</span> <span class="pre">{</span> <span class="pre">&quot;%lt&quot;:</span> <span class="pre">&quot;2000-01-01&quot;,</span> <span class="pre">&quot;%gte&quot;:</span> <span class="pre">&quot;1980-01-01&quot;</span> <span class="pre">}</span> <span class="pre">}</span> <span class="pre">}</span></code></p>
<ul class="simple">
<li>Match: <code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">person:</span> <span class="pre">{</span> <span class="pre">dob:</span> <span class="pre">&quot;1986-06-21&quot;</span> <span class="pre">}</span> <span class="pre">}</span></code></li>
<li>No match: <code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">person:</span> <span class="pre">{</span> <span class="pre">dob:</span> <span class="pre">&quot;1976-06-21&quot;</span> <span class="pre">}</span> <span class="pre">}</span></code></li>
<li>No match: <code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">person:</span> <span class="pre">{</span> <span class="pre">dob:</span> <span class="pre">&quot;2006-06-21&quot;</span> <span class="pre">}</span> <span class="pre">}</span></code></li>
</ul>
<p>These operators cannot occur in objects interpreted in a record context,
nor may other keys than these four operators occur where they are legal,
so there is no ambiguity with field equality.</p>
</div>
<div class="section" id="appendix-type-aware-queries">
<h2>Appendix: Type-aware queries<a class="headerlink" href="#appendix-type-aware-queries" title="Permalink to this headline">¶</a></h2>
<p><strong>This section is non-normative.</strong></p>
<p>This is not a <em>JSON</em> query language, it is a <em>Daml-LF</em> query
language. So, while we could theoretically treat queries (where not
otherwise interpreted by the “may contain additional properties” rule
above) without concern for what LF type (i.e. template) we’re
considering, we <em>will not</em> do so.</p>
<p>Consider the subquery <code class="docutils literal notranslate"><span class="pre">{&quot;foo&quot;:</span> <span class="pre">&quot;bar&quot;}</span></code>. This query conforms to types,
among an unbounded number of others:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>record A ↦ { foo : Text }
record B ↦ { foo : Optional Text }
variant C ↦ foo : Party | bar : Unit

// NB: LF does not require any particular case for VariantCon or Field;
// these are perfectly legal types in Daml-LF packages
</pre></div>
</div>
<p>In the cases of <code class="docutils literal notranslate"><span class="pre">A</span></code> and <code class="docutils literal notranslate"><span class="pre">B</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;foo&quot;</span></code> is part of the query
language, and only <code class="docutils literal notranslate"><span class="pre">&quot;bar&quot;</span></code> is treated as an LF value; in the case of
<code class="docutils literal notranslate"><span class="pre">C</span></code>, the whole query is treated as an LF value. The wide variety of
ambiguous interpretations about what elements are interpreted, and what
elements treated as literal, and <em>how</em> those elements are interpreted or
compared, would preclude many techniques for efficient query compilation
and LF value representation that we might otherwise consider.</p>
<p>Additionally, it would be extremely easy to overlook unintended meanings
of queries when writing them, and impossible in many cases to suppress
those unintended meanings within the query language. For example, there
is no way that the above query could be written to match <code class="docutils literal notranslate"><span class="pre">A</span></code> but never
<code class="docutils literal notranslate"><span class="pre">C</span></code>.</p>
<p>For these reasons, as with LF value input via JSON, queries written in
JSON are also always interpreted with respect to some specified LF types
(e.g. template IDs). For example:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;templateIds&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Foo:A&quot;</span><span class="p">,</span> <span class="s2">&quot;Foo:B&quot;</span><span class="p">,</span> <span class="s2">&quot;Foo:C&quot;</span><span class="p">],</span>
    <span class="nt">&quot;query&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nt">&quot;foo&quot;</span><span class="p">:</span> <span class="s2">&quot;bar&quot;</span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>will treat <code class="docutils literal notranslate"><span class="pre">&quot;foo&quot;</span></code> as a field equality query for A and B, and
(supposing templates’ associated data types were permitted to be
variants, which they are not, but for the sake of argument) as a whole
value equality query for C.</p>
<p>The above “Typecheck failure” happens because there is no LF type to
which both <code class="docutils literal notranslate"><span class="pre">&quot;Bob&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">[&quot;Bob&quot;,</span> <span class="pre">&quot;Sue&quot;]</span></code> conform; this would be
caught when interpreting the query, before considering any contracts.</p>
</div>
<div class="section" id="appendix-known-issues">
<h2>Appendix: Known issues<a class="headerlink" href="#appendix-known-issues" title="Permalink to this headline">¶</a></h2>
<div class="section" id="when-using-oracle-queries-fail-if-a-token-is-too-large">
<h3>When using Oracle, queries fail if a token is too large<a class="headerlink" href="#when-using-oracle-queries-fail-if-a-token-is-too-large" title="Permalink to this headline">¶</a></h3>
<p>This limitation is exclusive to users of the HTTP JSON API using the Enterprise Edition support for Oracle. Due to a known limitation in Oracle, the full-test JSON search index on the contract payloads rejects query tokens larger than 256 bytes. This limitations shouldn’t impact most workloads, but if this needs to be worked around, the HTTP JSON API server can be started passing the additional <code class="docutils literal notranslate"><span class="pre">disableContractPayloadIndexing=true</span></code> (after wiping an existing query store database, if necessary).</p>
<p><a class="reference external" href="https://github.com/digital-asset/daml/issues/10780">Issue on GitHub</a></p>
</div>
</div>
</div>


              
            </div>
            
            
              <!-- Copyright (c) 2021 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved. -->
<!-- SPDX-License-Identifier: Apache-2.0 -->

<footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="lf-value-specification.html" class="da-btn da-btn-label btn-prev" title="Daml-LF JSON Encoding" accesskey="p" rel="prev">Previous</a>
      
      
        <a href="production-setup.html" class="da-btn da-btn-label btn-next" title="Production Setup" accesskey="n" rel="next">Next</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        Copyright (c) 2021 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved. Any unauthorized use, duplication or distribution is strictly prohibited. &#34;Digital Asset&#34; and &#34;Daml&#34; are Registered in the U.S. Patent and Trademark Office.

    </p>
  </div> 

</footer>
            
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- Copyright (c) 2021 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved. -->
<!-- SPDX-License-Identifier: Apache-2.0 -->





  <script type="text/javascript">
    jQuery(function () {
      SphinxRtdTheme.Navigation.enable(true);
      });
  </script>


  
    
  
  <div id="inpageContent"></div>
  

</body>
</html>